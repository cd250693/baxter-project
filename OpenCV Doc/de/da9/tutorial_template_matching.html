<!-- HTML header for doxygen 1.8.6-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>OpenCV: Template Matching</title>
<link href="../../opencv.ico" rel="shortcut icon" type="image/x-icon" />
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js", "TeX/AMSmath.js", "TeX/AMSsymbols.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
MathJax.Hub.Config(
{
  TeX: {
      Macros: {
          matTT: [ "\\[ \\left|\\begin{array}{ccc} #1 & #2 & #3\\\\ #4 & #5 & #6\\\\ #7 & #8 & #9 \\end{array}\\right| \\]", 9],
          fork: ["\\left\\{ \\begin{array}{l l} #1 & \\mbox{#2}\\\\ #3 & \\mbox{#4}\\\\ \\end{array} \\right.", 4],
          forkthree: ["\\left\\{ \\begin{array}{l l} #1 & \\mbox{#2}\\\\ #3 & \\mbox{#4}\\\\ #5 & \\mbox{#6}\\\\ \\end{array} \\right.", 6],
          vecthree: ["\\begin{bmatrix} #1\\\\ #2\\\\ #3 \\end{bmatrix}", 3],
          vecthreethree: ["\\begin{bmatrix} #1 & #2 & #3\\\\ #4 & #5 & #6\\\\ #7 & #8 & #9 \\end{bmatrix}", 9],
          hdotsfor: ["\\dots", 1],
          mathbbm: ["\\mathbb{#1}", 1],
          bordermatrix: ["\\matrix{#1}", 1]
      }
  }
}
);
</script><script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="../../stylesheet.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="../../opencv-logo-small.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">OpenCV
   &#160;<span id="projectnumber">3.0.0</span>
   </div>
   <div id="projectbrief">Open Source Computer Vision</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="../../pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="../../modules.html"><span>Modules</span></a></li>
      <li><a href="../../namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="../../annotated.html"><span>Classes</span></a></li>
      <li><a href="../../files.html"><span>Files</span></a></li>
      <li><a href="../../examples.html"><span>Examples</span></a></li>
      <li><a href="../..//3.0-last-rst"><span>Sphinx&#160;Documentation</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="../../search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="../../search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Properties</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(11)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(12)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(13)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="../../d9/df8/tutorial_root.html">OpenCV Tutorials</a></li><li class="navelem"><a class="el" href="../../d7/da8/tutorial_table_of_content_imgproc.html">Image Processing (imgproc module)</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Template Matching </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h2>Goal </h2>
<p>In this tutorial you will learn how to:</p>
<ul>
<li>Use the OpenCV function <a class="el" href="../../df/dfb/group__imgproc__object.html#ga586ebfb0a7fb604b35a23d85391329be">cv::matchTemplate</a> to search for matches between an image patch and an input image</li>
<li>Use the OpenCV function <a class="el" href="../../d2/de8/group__core__array.html#gab473bf2eb6d14ff97e89b355dac20707">cv::minMaxLoc</a> to find the maximum and minimum values (as well as their positions) in a given array.</li>
</ul>
<h2>Theory </h2>
<h3>What is template matching?</h3>
<p>Template matching is a technique for finding areas of an image that match (are similar) to a template image (patch).</p>
<h3>How does it work?</h3>
<ul>
<li><p class="startli">We need two primary components:</p>
<ol type="1">
<li><b>Source image (I):</b> The image in which we expect to find a match to the template image</li>
<li><b>Template image (T):</b> The patch image which will be compared to the template image</li>
</ol>
<p class="startli">our goal is to detect the highest matching area:</p>
<div class="image">
<img src="../../Template_Matching_Template_Theory_Summary.jpg" alt="Template_Matching_Template_Theory_Summary.jpg"/>
</div>
</li>
<li><p class="startli">To identify the matching area, we have to <em>compare</em> the template image against the source image by sliding it:</p>
<div class="image">
<img src="../../Template_Matching_Template_Theory_Sliding.jpg" alt="Template_Matching_Template_Theory_Sliding.jpg"/>
</div>
</li>
<li>By <b>sliding</b>, we mean moving the patch one pixel at a time (left to right, up to down). At each location, a metric is calculated so it represents how "good" or "bad" the match at that location is (or how similar the patch is to that particular area of the source image).</li>
<li><p class="startli">For each location of <b>T</b> over <b>I</b>, you <em>store</em> the metric in the <em>result matrix</em> **(R)**. Each location \((x,y)\) in <b>R</b> contains the match metric:</p>
<div class="image">
<img src="../../Template_Matching_Template_Theory_Result.jpg" alt="Template_Matching_Template_Theory_Result.jpg"/>
</div>
<p class="startli">the image above is the result <b>R</b> of sliding the patch with a metric <b>TM_CCORR_NORMED</b>. The brightest locations indicate the highest matches. As you can see, the location marked by the red circle is probably the one with the highest value, so that location (the rectangle formed by that point as a corner and width and height equal to the patch image) is considered the match.</p>
</li>
<li>In practice, we use the function <a class="el" href="../../d2/de8/group__core__array.html#gab473bf2eb6d14ff97e89b355dac20707">cv::minMaxLoc</a> to locate the highest value (or lower, depending of the type of matching method) in the <em>R</em> matrix.</li>
</ul>
<h3>Which are the matching methods available in OpenCV?</h3>
<p>Good question. OpenCV implements Template matching in the function <a class="el" href="../../df/dfb/group__imgproc__object.html#ga586ebfb0a7fb604b35a23d85391329be">cv::matchTemplate</a> . The available methods are 6:</p>
<ol type="1">
<li><p class="startli"><b>method=CV_TM_SQDIFF</b></p>
<p class="formulaDsp">
\[R(x,y)= \sum _{x&#39;,y&#39;} (T(x&#39;,y&#39;)-I(x+x&#39;,y+y&#39;))^2\]
</p>
</li>
<li><p class="startli"><b>method=CV_TM_SQDIFF_NORMED</b></p>
<p class="formulaDsp">
\[R(x,y)= \frac{\sum_{x&#39;,y&#39;} (T(x&#39;,y&#39;)-I(x+x&#39;,y+y&#39;))^2}{\sqrt{\sum_{x&#39;,y&#39;}T(x&#39;,y&#39;)^2 \cdot \sum_{x&#39;,y&#39;} I(x+x&#39;,y+y&#39;)^2}}\]
</p>
</li>
<li><p class="startli"><b>method=CV_TM_CCORR</b></p>
<p class="formulaDsp">
\[R(x,y)= \sum _{x&#39;,y&#39;} (T(x&#39;,y&#39;) \cdot I(x+x&#39;,y+y&#39;))\]
</p>
</li>
<li><p class="startli"><b>method=CV_TM_CCORR_NORMED</b></p>
<p class="formulaDsp">
\[R(x,y)= \frac{\sum_{x&#39;,y&#39;} (T(x&#39;,y&#39;) \cdot I(x+x&#39;,y+y&#39;))}{\sqrt{\sum_{x&#39;,y&#39;}T(x&#39;,y&#39;)^2 \cdot \sum_{x&#39;,y&#39;} I(x+x&#39;,y+y&#39;)^2}}\]
</p>
</li>
<li><p class="startli"><b>method=CV_TM_CCOEFF</b></p>
<p class="formulaDsp">
\[R(x,y)= \sum _{x&#39;,y&#39;} (T&#39;(x&#39;,y&#39;) \cdot I&#39;(x+x&#39;,y+y&#39;))\]
</p>
<p class="startli">where</p>
<p class="formulaDsp">
\[\begin{array}{l} T&#39;(x&#39;,y&#39;)=T(x&#39;,y&#39;) - 1/(w \cdot h) \cdot \sum _{x&#39;&#39;,y&#39;&#39;} T(x&#39;&#39;,y&#39;&#39;) \\ I&#39;(x+x&#39;,y+y&#39;)=I(x+x&#39;,y+y&#39;) - 1/(w \cdot h) \cdot \sum _{x&#39;&#39;,y&#39;&#39;} I(x+x&#39;&#39;,y+y&#39;&#39;) \end{array}\]
</p>
</li>
<li><p class="startli"><b>method=CV_TM_CCOEFF_NORMED</b></p>
<p class="formulaDsp">
\[R(x,y)= \frac{ \sum_{x&#39;,y&#39;} (T&#39;(x&#39;,y&#39;) \cdot I&#39;(x+x&#39;,y+y&#39;)) }{ \sqrt{\sum_{x&#39;,y&#39;}T&#39;(x&#39;,y&#39;)^2 \cdot \sum_{x&#39;,y&#39;} I&#39;(x+x&#39;,y+y&#39;)^2} }\]
</p>
</li>
</ol>
<h2>Code </h2>
<ul>
<li><b>What does this program do?</b><ul>
<li>Loads an input image and a image patch (<em>template</em>)</li>
<li>Perform a template matching procedure by using the OpenCV function <a class="el" href="../../df/dfb/group__imgproc__object.html#ga586ebfb0a7fb604b35a23d85391329be">cv::matchTemplate</a> with any of the 6 matching methods described before. The user can choose the method by entering its selection in the Trackbar.</li>
<li>Normalize the output of the matching procedure</li>
<li>Localize the location with higher matching probability</li>
<li>Draw a rectangle around the area corresponding to the highest match</li>
</ul>
</li>
<li><b>Downloadable code</b>: Click <a href="https://github.com/Itseez/opencv/tree/master/samples/cpp/tutorial_code/Histograms_Matching/MatchTemplate_Demo.cpp">here</a></li>
<li><b>Code at glance:</b> <div class="fragment"><div class="line"></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="../../d6/d87/imgcodecs_8hpp.html">opencv2/imgcodecs.hpp</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="../../d0/dce/highgui_2highgui_8hpp.html">opencv2/highgui/highgui.hpp</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="../../d5/dba/imgproc_2imgproc_8hpp.html">opencv2/imgproc/imgproc.hpp</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &lt;iostream&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;stdio.h&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="keyword">using namespace </span>std;</div>
<div class="line"><span class="keyword">using namespace </span>cv;</div>
<div class="line"></div>
<div class="line"><a class="code" href="../../d3/d63/classcv_1_1Mat.html">Mat</a> img; <a class="code" href="../../d3/d63/classcv_1_1Mat.html">Mat</a> templ; <a class="code" href="../../d3/d63/classcv_1_1Mat.html">Mat</a> result;</div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">char</span>* image_window = <span class="stringliteral">&quot;Source Image&quot;</span>;</div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">char</span>* result_window = <span class="stringliteral">&quot;Result window&quot;</span>;</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">int</span> match_method;</div>
<div class="line"><span class="keywordtype">int</span> max_Trackbar = 5;</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> MatchingMethod( <span class="keywordtype">int</span>, <span class="keywordtype">void</span>* );</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">int</span> main( <span class="keywordtype">int</span>, <span class="keywordtype">char</span>** argv )</div>
<div class="line">{</div>
<div class="line">  img = <a class="code" href="../../d4/da8/group__imgcodecs.html#ga288b8b3da0892bd651fce07b3bbd3a56">imread</a>( argv[1], 1 );</div>
<div class="line">  templ = <a class="code" href="../../d4/da8/group__imgcodecs.html#ga288b8b3da0892bd651fce07b3bbd3a56">imread</a>( argv[2], 1 );</div>
<div class="line"></div>
<div class="line">  <a class="code" href="../../d7/dfc/group__highgui.html#ga5afdf8410934fd099df85c75b2e0888b">namedWindow</a>( image_window, <a class="code" href="../../d7/dfc/group__highgui.html#gga5ad07fe792324e77cfd0775f6978776facf621ace7a54954cbac01df27e47228f">WINDOW_AUTOSIZE</a> );</div>
<div class="line">  <a class="code" href="../../d7/dfc/group__highgui.html#ga5afdf8410934fd099df85c75b2e0888b">namedWindow</a>( result_window, <a class="code" href="../../d7/dfc/group__highgui.html#gga5ad07fe792324e77cfd0775f6978776facf621ace7a54954cbac01df27e47228f">WINDOW_AUTOSIZE</a> );</div>
<div class="line"></div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">char</span>* trackbar_label = <span class="stringliteral">&quot;Method: \n 0: SQDIFF \n 1: SQDIFF NORMED \n 2: TM CCORR \n 3: TM CCORR NORMED \n 4: TM COEFF \n 5: TM COEFF NORMED&quot;</span>;</div>
<div class="line">  <a class="code" href="../../d7/dfc/group__highgui.html#gaf78d2155d30b728fc413803745b67a9b">createTrackbar</a>( trackbar_label, image_window, &amp;match_method, max_Trackbar, MatchingMethod );</div>
<div class="line"></div>
<div class="line">  MatchingMethod( 0, 0 );</div>
<div class="line"></div>
<div class="line">  <a class="code" href="../../d7/dfc/group__highgui.html#ga5628525ad33f52eab17feebcfba38bd7">waitKey</a>(0);</div>
<div class="line">  <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> MatchingMethod( <span class="keywordtype">int</span>, <span class="keywordtype">void</span>* )</div>
<div class="line">{</div>
<div class="line">  <a class="code" href="../../d3/d63/classcv_1_1Mat.html">Mat</a> img_display;</div>
<div class="line">  img.<a class="code" href="../../d3/d63/classcv_1_1Mat.html#a4331fa88593a9a9c14c0998574695ebb">copyTo</a>( img_display );</div>
<div class="line"></div>
<div class="line">  <span class="keywordtype">int</span> result_cols =  img.cols - templ.cols + 1;</div>
<div class="line">  <span class="keywordtype">int</span> result_rows = img.rows - templ.rows + 1;</div>
<div class="line"></div>
<div class="line">  result.create( result_rows, result_cols, <a class="code" href="../../dc/dcc/cvdef_8h.html#a32ec76240e43e4c9c7b2e2785180a7e6">CV_32FC1</a> );</div>
<div class="line"></div>
<div class="line">  <a class="code" href="../../df/dfb/group__imgproc__object.html#ga586ebfb0a7fb604b35a23d85391329be">matchTemplate</a>( img, templ, result, match_method );</div>
<div class="line">  <a class="code" href="../../dc/d84/group__core__basic.html#ga1b6a396a456c8b6c6e4afd8591560d80">normalize</a>( result, result, 0, 1, <a class="code" href="../../d2/de8/group__core__array.html#ggad12cefbcb5291cf958a85b4b67b6149fa9f0c1c342a18114d47b516a88e29822e">NORM_MINMAX</a>, -1, <a class="code" href="../../d3/d63/classcv_1_1Mat.html">Mat</a>() );</div>
<div class="line"></div>
<div class="line">  <span class="keywordtype">double</span> minVal; <span class="keywordtype">double</span> maxVal; <a class="code" href="../../db/d4e/classcv_1_1Point__.html">Point</a> minLoc; <a class="code" href="../../db/d4e/classcv_1_1Point__.html">Point</a> maxLoc;</div>
<div class="line">  <a class="code" href="../../db/d4e/classcv_1_1Point__.html">Point</a> matchLoc;</div>
<div class="line"></div>
<div class="line">  <a class="code" href="../../d2/de8/group__core__array.html#gab473bf2eb6d14ff97e89b355dac20707">minMaxLoc</a>( result, &amp;minVal, &amp;maxVal, &amp;minLoc, &amp;maxLoc, <a class="code" href="../../d3/d63/classcv_1_1Mat.html">Mat</a>() );</div>
<div class="line"></div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span>( match_method  == <a class="code" href="../../df/dfb/group__imgproc__object.html#gga3a7850640f1fe1f58fe91a2d7583695dab65c042ed62c9e9e095a1e7e41fe2773">TM_SQDIFF</a> || match_method == <a class="code" href="../../df/dfb/group__imgproc__object.html#gga3a7850640f1fe1f58fe91a2d7583695da5382c8f9df87e87cf1e9f9927dc3bc31">TM_SQDIFF_NORMED</a> )</div>
<div class="line">    { matchLoc = minLoc; }</div>
<div class="line">  <span class="keywordflow">else</span></div>
<div class="line">    { matchLoc = maxLoc; }</div>
<div class="line"></div>
<div class="line">  <a class="code" href="../../d6/d6e/group__imgproc__draw.html#ga07d2f74cadcf8e305e810ce8eed13bc9">rectangle</a>( img_display, matchLoc, <a class="code" href="../../dc/d84/group__core__basic.html#ga1e83eafb2d26b3c93f09e8338bcab192">Point</a>( matchLoc.<a class="code" href="../../db/d4e/classcv_1_1Point__.html#a4c96fa7bdbfe390be5ed356edb274ff3">x</a> + templ.cols , matchLoc.<a class="code" href="../../db/d4e/classcv_1_1Point__.html#a157337197338ff199e5df1a393022f15">y</a> + templ.rows ), Scalar::all(0), 2, 8, 0 );</div>
<div class="line">  <a class="code" href="../../d6/d6e/group__imgproc__draw.html#ga07d2f74cadcf8e305e810ce8eed13bc9">rectangle</a>( result, matchLoc, <a class="code" href="../../dc/d84/group__core__basic.html#ga1e83eafb2d26b3c93f09e8338bcab192">Point</a>( matchLoc.<a class="code" href="../../db/d4e/classcv_1_1Point__.html#a4c96fa7bdbfe390be5ed356edb274ff3">x</a> + templ.cols , matchLoc.<a class="code" href="../../db/d4e/classcv_1_1Point__.html#a157337197338ff199e5df1a393022f15">y</a> + templ.rows ), Scalar::all(0), 2, 8, 0 );</div>
<div class="line"></div>
<div class="line">  <a class="code" href="../../d7/dfc/group__highgui.html#ga453d42fe4cb60e5723281a89973ee563">imshow</a>( image_window, img_display );</div>
<div class="line">  <a class="code" href="../../d7/dfc/group__highgui.html#ga453d42fe4cb60e5723281a89973ee563">imshow</a>( result_window, result );</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">return</span>;</div>
<div class="line">}</div>
</div><!-- fragment --></li>
</ul>
<h2>Explanation </h2>
<ol type="1">
<li>Declare some global variables, such as the image, template and result matrices, as well as the match method and the window names: <div class="fragment"><div class="line">Mat img; Mat templ; Mat result;</div>
<div class="line"><span class="keywordtype">char</span>* image_window = <span class="stringliteral">&quot;Source Image&quot;</span>;</div>
<div class="line"><span class="keywordtype">char</span>* result_window = <span class="stringliteral">&quot;Result window&quot;</span>;</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">int</span> match_method;</div>
<div class="line"><span class="keywordtype">int</span> max_Trackbar = 5;</div>
</div><!-- fragment --></li>
<li>Load the source image and template: <div class="fragment"><div class="line">img = <a class="code" href="../../d4/da8/group__imgcodecs.html#ga288b8b3da0892bd651fce07b3bbd3a56">imread</a>( argv[1], 1 );</div>
<div class="line">templ = <a class="code" href="../../d4/da8/group__imgcodecs.html#ga288b8b3da0892bd651fce07b3bbd3a56">imread</a>( argv[2], 1 );</div>
</div><!-- fragment --></li>
<li>Create the windows to show the results: <div class="fragment"><div class="line"><a class="code" href="../../d7/dfc/group__highgui.html#ga5afdf8410934fd099df85c75b2e0888b">namedWindow</a>( image_window, <a class="code" href="../../d7/dfc/group__highgui.html#gga5ad07fe792324e77cfd0775f6978776facf621ace7a54954cbac01df27e47228f">WINDOW_AUTOSIZE</a> );</div>
<div class="line"><a class="code" href="../../d7/dfc/group__highgui.html#ga5afdf8410934fd099df85c75b2e0888b">namedWindow</a>( result_window, <a class="code" href="../../d7/dfc/group__highgui.html#gga5ad07fe792324e77cfd0775f6978776facf621ace7a54954cbac01df27e47228f">WINDOW_AUTOSIZE</a> );</div>
</div><!-- fragment --></li>
<li>Create the Trackbar to enter the kind of matching method to be used. When a change is detected the callback function <b>MatchingMethod</b> is called. <div class="fragment"><div class="line"><span class="keywordtype">char</span>* trackbar_label = <span class="stringliteral">&quot;Method: \n 0: SQDIFF \n 1: SQDIFF NORMED \n 2: TM CCORR \n 3: TM CCORR NORMED \n 4: TM COEFF \n 5: TM COEFF NORMED&quot;</span>;</div>
<div class="line"><a class="code" href="../../d7/dfc/group__highgui.html#gaf78d2155d30b728fc413803745b67a9b">createTrackbar</a>( trackbar_label, image_window, &amp;match_method, max_Trackbar, MatchingMethod );</div>
</div><!-- fragment --></li>
<li>Wait until user exits the program. <div class="fragment"><div class="line"><a class="code" href="../../d7/dfc/group__highgui.html#ga5628525ad33f52eab17feebcfba38bd7">waitKey</a>(0);</div>
<div class="line"><span class="keywordflow">return</span> 0;</div>
</div><!-- fragment --></li>
<li>Let's check out the callback function. First, it makes a copy of the source image: <div class="fragment"><div class="line">Mat img_display;</div>
<div class="line">img.<a class="code" href="../../d3/d63/classcv_1_1Mat.html#a4331fa88593a9a9c14c0998574695ebb">copyTo</a>( img_display );</div>
</div><!-- fragment --></li>
<li>Next, it creates the result matrix that will store the matching results for each template location. Observe in detail the size of the result matrix (which matches all possible locations for it) <div class="fragment"><div class="line"><span class="keywordtype">int</span> result_cols =  img.cols - templ.cols + 1;</div>
<div class="line"><span class="keywordtype">int</span> result_rows = img.rows - templ.rows + 1;</div>
<div class="line"></div>
<div class="line">result.create( result_rows, result_cols, <a class="code" href="../../dc/dcc/cvdef_8h.html#a32ec76240e43e4c9c7b2e2785180a7e6">CV_32FC1</a> );</div>
</div><!-- fragment --></li>
<li>Perform the template matching operation: <div class="fragment"><div class="line"><a class="code" href="../../df/dfb/group__imgproc__object.html#ga586ebfb0a7fb604b35a23d85391329be">matchTemplate</a>( img, templ, result, match_method );</div>
</div><!-- fragment --> the arguments are naturally the input image <b>I</b>, the template <b>T</b>, the result <b>R</b> and the match_method (given by the Trackbar)</li>
<li>We normalize the results: <div class="fragment"><div class="line"><a class="code" href="../../dc/d84/group__core__basic.html#ga1b6a396a456c8b6c6e4afd8591560d80">normalize</a>( result, result, 0, 1, <a class="code" href="../../d2/de8/group__core__array.html#ggad12cefbcb5291cf958a85b4b67b6149fa9f0c1c342a18114d47b516a88e29822e">NORM_MINMAX</a>, -1, Mat() );</div>
</div><!-- fragment --></li>
<li>We localize the minimum and maximum values in the result matrix <b>R</b> by using <a class="el" href="../../d2/de8/group__core__array.html#gab473bf2eb6d14ff97e89b355dac20707">cv::minMaxLoc</a> . <div class="fragment"><div class="line"><span class="keywordtype">double</span> minVal; <span class="keywordtype">double</span> maxVal; <a class="code" href="../../dc/d84/group__core__basic.html#ga1e83eafb2d26b3c93f09e8338bcab192">Point</a> minLoc; <a class="code" href="../../dc/d84/group__core__basic.html#ga1e83eafb2d26b3c93f09e8338bcab192">Point</a> maxLoc;</div>
<div class="line"><a class="code" href="../../dc/d84/group__core__basic.html#ga1e83eafb2d26b3c93f09e8338bcab192">Point</a> matchLoc;</div>
<div class="line"></div>
<div class="line"><a class="code" href="../../d2/de8/group__core__array.html#gab473bf2eb6d14ff97e89b355dac20707">minMaxLoc</a>( result, &amp;minVal, &amp;maxVal, &amp;minLoc, &amp;maxLoc, Mat() );</div>
</div><!-- fragment --> the function calls as arguments:<ul>
<li><b>result:</b> The source array</li>
<li>**&amp;minVal** and **&amp;maxVal:** Variables to save the minimum and maximum values in <b>result</b></li>
<li>**&amp;minLoc** and **&amp;maxLoc:** The Point locations of the minimum and maximum values in the array.</li>
<li><b>Mat():</b> Optional mask</li>
</ul>
</li>
<li>For the first two methods ( TM_SQDIFF and MT_SQDIFF_NORMED ) the best match are the lowest values. For all the others, higher values represent better matches. So, we save the corresponding value in the <b>matchLoc</b> variable: <div class="fragment"><div class="line"><span class="keywordflow">if</span>( match_method  == <a class="code" href="../../df/dfb/group__imgproc__object.html#gga3a7850640f1fe1f58fe91a2d7583695dab65c042ed62c9e9e095a1e7e41fe2773">TM_SQDIFF</a> || match_method == <a class="code" href="../../df/dfb/group__imgproc__object.html#gga3a7850640f1fe1f58fe91a2d7583695da5382c8f9df87e87cf1e9f9927dc3bc31">TM_SQDIFF_NORMED</a> )</div>
<div class="line">  { matchLoc = minLoc; }</div>
<div class="line"><span class="keywordflow">else</span></div>
<div class="line">  { matchLoc = maxLoc; }</div>
</div><!-- fragment --></li>
<li>Display the source image and the result matrix. Draw a rectangle around the highest possible matching area: <div class="fragment"><div class="line"><a class="code" href="../../d6/d6e/group__imgproc__draw.html#ga07d2f74cadcf8e305e810ce8eed13bc9">rectangle</a>( img_display, matchLoc, <a class="code" href="../../dc/d84/group__core__basic.html#ga1e83eafb2d26b3c93f09e8338bcab192">Point</a>( matchLoc.x + templ.cols , matchLoc.y + templ.rows ), Scalar::all(0), 2, 8, 0 );</div>
<div class="line"><a class="code" href="../../d6/d6e/group__imgproc__draw.html#ga07d2f74cadcf8e305e810ce8eed13bc9">rectangle</a>( result, matchLoc, <a class="code" href="../../dc/d84/group__core__basic.html#ga1e83eafb2d26b3c93f09e8338bcab192">Point</a>( matchLoc.x + templ.cols , matchLoc.y + templ.rows ), Scalar::all(0), 2, 8, 0 );</div>
<div class="line"></div>
<div class="line"><a class="code" href="../../d7/dfc/group__highgui.html#ga453d42fe4cb60e5723281a89973ee563">imshow</a>( image_window, img_display );</div>
<div class="line"><a class="code" href="../../d7/dfc/group__highgui.html#ga453d42fe4cb60e5723281a89973ee563">imshow</a>( result_window, result );</div>
</div><!-- fragment --></li>
</ol>
<h2>Results </h2>
<ol type="1">
<li><p class="startli">Testing our program with an input image such as:</p>
<div class="image">
<img src="../../Template_Matching_Original_Image.jpg" alt="Template_Matching_Original_Image.jpg"/>
</div>
<p class="startli">and a template image:</p>
<div class="image">
<img src="../../Template_Matching_Template_Image.jpg" alt="Template_Matching_Template_Image.jpg"/>
</div>
</li>
<li>Generate the following result matrices (first row are the standard methods SQDIFF, CCORR and CCOEFF, second row are the same methods in its normalized version). In the first column, the darkest is the better match, for the other two columns, the brighter a location, the higher the match. <div class="image">
<img src="../../Template_Matching_Correl_Result_0.jpg" alt="Template_Matching_Correl_Result_0.jpg"/>
<div class="caption">
Result_0</div></div>
 <div class="image">
<img src="../../Template_Matching_Correl_Result_1.jpg" alt="Template_Matching_Correl_Result_1.jpg"/>
<div class="caption">
Result_1</div></div>
 <div class="image">
<img src="../../Template_Matching_Correl_Result_2.jpg" alt="Template_Matching_Correl_Result_2.jpg"/>
<div class="caption">
Result_2</div></div>
 <div class="image">
<img src="../../Template_Matching_Correl_Result_3.jpg" alt="Template_Matching_Correl_Result_3.jpg"/>
<div class="caption">
Result_3</div></div>
 <div class="image">
<img src="../../Template_Matching_Correl_Result_4.jpg" alt="Template_Matching_Correl_Result_4.jpg"/>
<div class="caption">
Result_4</div></div>
 <div class="image">
<img src="../../Template_Matching_Correl_Result_5.jpg" alt="Template_Matching_Correl_Result_5.jpg"/>
<div class="caption">
Result_5</div></div>
</li>
<li><p class="startli">The right match is shown below (black rectangle around the face of the guy at the right). Notice that CCORR and CCDEFF gave erroneous best matches, however their normalized version did it right, this may be due to the fact that we are only considering the "highest match" and not the other possible high matches.</p>
<div class="image">
<img src="../../Template_Matching_Image_Result.jpg" alt="Template_Matching_Image_Result.jpg"/>
</div>
 </li>
</ol>
</div></div><!-- contents -->
<!-- HTML footer for doxygen 1.8.6-->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Sat Jun 20 2015 13:08:39 for OpenCV by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/>
</a> 1.8.6
</small></address>
</body>
</html>
