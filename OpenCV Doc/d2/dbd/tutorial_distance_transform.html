<!-- HTML header for doxygen 1.8.6-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>OpenCV: Image Segmentation with Distance Transform and Watershed Algorithm</title>
<link href="../../opencv.ico" rel="shortcut icon" type="image/x-icon" />
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js", "TeX/AMSmath.js", "TeX/AMSsymbols.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
MathJax.Hub.Config(
{
  TeX: {
      Macros: {
          matTT: [ "\\[ \\left|\\begin{array}{ccc} #1 & #2 & #3\\\\ #4 & #5 & #6\\\\ #7 & #8 & #9 \\end{array}\\right| \\]", 9],
          fork: ["\\left\\{ \\begin{array}{l l} #1 & \\mbox{#2}\\\\ #3 & \\mbox{#4}\\\\ \\end{array} \\right.", 4],
          forkthree: ["\\left\\{ \\begin{array}{l l} #1 & \\mbox{#2}\\\\ #3 & \\mbox{#4}\\\\ #5 & \\mbox{#6}\\\\ \\end{array} \\right.", 6],
          vecthree: ["\\begin{bmatrix} #1\\\\ #2\\\\ #3 \\end{bmatrix}", 3],
          vecthreethree: ["\\begin{bmatrix} #1 & #2 & #3\\\\ #4 & #5 & #6\\\\ #7 & #8 & #9 \\end{bmatrix}", 9],
          hdotsfor: ["\\dots", 1],
          mathbbm: ["\\mathbb{#1}", 1],
          bordermatrix: ["\\matrix{#1}", 1]
      }
  }
}
);
</script><script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="../../stylesheet.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="../../opencv-logo-small.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">OpenCV
   &#160;<span id="projectnumber">3.0.0</span>
   </div>
   <div id="projectbrief">Open Source Computer Vision</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="../../pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="../../modules.html"><span>Modules</span></a></li>
      <li><a href="../../namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="../../annotated.html"><span>Classes</span></a></li>
      <li><a href="../../files.html"><span>Files</span></a></li>
      <li><a href="../../examples.html"><span>Examples</span></a></li>
      <li><a href="../..//3.0-last-rst"><span>Sphinx&#160;Documentation</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="../../search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="../../search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Properties</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(11)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(12)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(13)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="../../d9/df8/tutorial_root.html">OpenCV Tutorials</a></li><li class="navelem"><a class="el" href="../../d7/da8/tutorial_table_of_content_imgproc.html">Image Processing (imgproc module)</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Image Segmentation with Distance Transform and Watershed Algorithm </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h2>Goal </h2>
<p>In this tutorial you will learn how to:</p>
<ul>
<li>Use the OpenCV function <a class="el" href="../../d4/d86/group__imgproc__filter.html#ga27c049795ce870216ddfb366086b5a04">cv::filter2D</a> in order to perform some laplacian filtering for image sharpening</li>
<li>Use the OpenCV function <a class="el" href="../../d7/d1b/group__imgproc__misc.html#ga8a0b7fdfcb7a13dde018988ba3a43042">cv::distanceTransform</a> in order to obtain the derived representation of a binary image, where the value of each pixel is replaced by its distance to the nearest background pixel</li>
<li>Use the OpenCV function <a class="el" href="../../d7/d1b/group__imgproc__misc.html#ga3267243e4d3f95165d55a618c65ac6e1">cv::watershed</a> in order to isolate objects in the image from the background</li>
</ul>
<h2>Theory </h2>
<h2>Code </h2>
<p>This tutorial code's is shown lines below. You can also download it from <a href="https://github.com/Itseez/opencv/tree/master/samples/cpp/tutorial_code/ImgTrans/imageSegmentation.cpp">here</a>. </p>
<div class="fragment"><div class="line"></div>
<div class="line"><span class="preprocessor">#include &lt;opencv2/opencv.hpp&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;iostream&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="keyword">using namespace </span>std;</div>
<div class="line"><span class="keyword">using namespace </span>cv;</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">int</span>, <span class="keywordtype">char</span>** argv)</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// Load the image</span></div>
<div class="line">    <a class="code" href="../../d3/d63/classcv_1_1Mat.html">Mat</a> src = <a class="code" href="../../d4/da8/group__imgcodecs.html#ga288b8b3da0892bd651fce07b3bbd3a56">imread</a>(argv[1]);</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Check if everything was fine</span></div>
<div class="line">    <span class="keywordflow">if</span> (!src.<a class="code" href="../../d3/d63/classcv_1_1Mat.html#a4d33bed1c850265370d2af0ff02e1564">data</a>)</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Show source image</span></div>
<div class="line">    <a class="code" href="../../d7/dfc/group__highgui.html#ga453d42fe4cb60e5723281a89973ee563">imshow</a>(<span class="stringliteral">&quot;Source Image&quot;</span>, src);</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Change the background from white to black, since that will help later to extract</span></div>
<div class="line">    <span class="comment">// better results during the use of Distance Transform</span></div>
<div class="line">    <span class="keywordflow">for</span>( <span class="keywordtype">int</span> x = 0; x &lt; src.<a class="code" href="../../d3/d63/classcv_1_1Mat.html#abed816466c45234254d25bc59c31245e">rows</a>; x++ ) {</div>
<div class="line">      <span class="keywordflow">for</span>( <span class="keywordtype">int</span> y = 0; y &lt; src.<a class="code" href="../../d3/d63/classcv_1_1Mat.html#aa3e5a47585c9ef6a0842556739155e3e">cols</a>; y++ ) {</div>
<div class="line">          <span class="keywordflow">if</span> ( src.<a class="code" href="../../d3/d63/classcv_1_1Mat.html#aa5d20fc86d41d59e4d71ae93daee9726">at</a>&lt;<a class="code" href="../../d6/dcf/classcv_1_1Vec.html">Vec3b</a>&gt;(x, y) == <a class="code" href="../../d6/dcf/classcv_1_1Vec.html">Vec3b</a>(255,255,255) ) {</div>
<div class="line">            src.<a class="code" href="../../d3/d63/classcv_1_1Mat.html#aa5d20fc86d41d59e4d71ae93daee9726">at</a>&lt;<a class="code" href="../../d6/dcf/classcv_1_1Vec.html">Vec3b</a>&gt;(x, y)[0] = 0;</div>
<div class="line">            src.<a class="code" href="../../d3/d63/classcv_1_1Mat.html#aa5d20fc86d41d59e4d71ae93daee9726">at</a>&lt;<a class="code" href="../../d6/dcf/classcv_1_1Vec.html">Vec3b</a>&gt;(x, y)[1] = 0;</div>
<div class="line">            src.<a class="code" href="../../d3/d63/classcv_1_1Mat.html#aa5d20fc86d41d59e4d71ae93daee9726">at</a>&lt;<a class="code" href="../../d6/dcf/classcv_1_1Vec.html">Vec3b</a>&gt;(x, y)[2] = 0;</div>
<div class="line">          }</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Show output image</span></div>
<div class="line">    <a class="code" href="../../d7/dfc/group__highgui.html#ga453d42fe4cb60e5723281a89973ee563">imshow</a>(<span class="stringliteral">&quot;Black Background Image&quot;</span>, src);</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Create a kernel that we will use for accuting/sharpening our image</span></div>
<div class="line">    <a class="code" href="../../d3/d63/classcv_1_1Mat.html">Mat</a> kernel = (<a class="code" href="../../df/dfc/classcv_1_1Mat__.html">Mat_&lt;float&gt;</a>(3,3) &lt;&lt;</div>
<div class="line">            1,  1, 1,</div>
<div class="line">            1, -8, 1,</div>
<div class="line">            1,  1, 1); <span class="comment">// an approximation of second derivative, a quite strong kernel</span></div>
<div class="line"></div>
<div class="line">    <span class="comment">// do the laplacian filtering as it is</span></div>
<div class="line">    <span class="comment">// well, we need to convert everything in something more deeper then CV_8U</span></div>
<div class="line">    <span class="comment">// because the kernel has some negative values,</span></div>
<div class="line">    <span class="comment">// and we can expect in general to have a Laplacian image with negative values</span></div>
<div class="line">    <span class="comment">// BUT a 8bits unsigned int (the one we are working with) can contain values from 0 to 255</span></div>
<div class="line">    <span class="comment">// so the possible negative number will be truncated</span></div>
<div class="line">    <a class="code" href="../../d3/d63/classcv_1_1Mat.html">Mat</a> imgLaplacian;</div>
<div class="line">    <a class="code" href="../../d3/d63/classcv_1_1Mat.html">Mat</a> sharp = src; <span class="comment">// copy source image to another temporary one</span></div>
<div class="line">    <a class="code" href="../../d4/d86/group__imgproc__filter.html#ga27c049795ce870216ddfb366086b5a04">filter2D</a>(sharp, imgLaplacian, <a class="code" href="../../dc/dcc/cvdef_8h.html#a4a3def5d72b74bed31f5f8ab7676099c">CV_32F</a>, kernel);</div>
<div class="line">    src.<a class="code" href="../../d3/d63/classcv_1_1Mat.html#a3f356665bb0ca452e7d7723ccac9a810">convertTo</a>(sharp, <a class="code" href="../../dc/dcc/cvdef_8h.html#a4a3def5d72b74bed31f5f8ab7676099c">CV_32F</a>);</div>
<div class="line">    <a class="code" href="../../d3/d63/classcv_1_1Mat.html">Mat</a> imgResult = sharp - imgLaplacian;</div>
<div class="line"></div>
<div class="line">    <span class="comment">// convert back to 8bits gray scale</span></div>
<div class="line">    imgResult.<a class="code" href="../../d3/d63/classcv_1_1Mat.html#a3f356665bb0ca452e7d7723ccac9a810">convertTo</a>(imgResult, <a class="code" href="../../dc/dcc/cvdef_8h.html#a88c4cd9de76f678f33928ef1e3f96047">CV_8UC3</a>);</div>
<div class="line">    imgLaplacian.convertTo(imgLaplacian, <a class="code" href="../../dc/dcc/cvdef_8h.html#a88c4cd9de76f678f33928ef1e3f96047">CV_8UC3</a>);</div>
<div class="line"></div>
<div class="line">    <span class="comment">// imshow( &quot;Laplace Filtered Image&quot;, imgLaplacian );</span></div>
<div class="line">    <a class="code" href="../../d7/dfc/group__highgui.html#ga453d42fe4cb60e5723281a89973ee563">imshow</a>( <span class="stringliteral">&quot;New Sharped Image&quot;</span>, imgResult );</div>
<div class="line"></div>
<div class="line">    src = imgResult; <span class="comment">// copy back</span></div>
<div class="line"></div>
<div class="line">    <span class="comment">// Create binary image from source image</span></div>
<div class="line">    <a class="code" href="../../d3/d63/classcv_1_1Mat.html">Mat</a> bw;</div>
<div class="line">    <a class="code" href="../../d7/d1b/group__imgproc__misc.html#ga397ae87e1288a81d2363b61574eb8cab">cvtColor</a>(src, bw, <a class="code" href="../../df/d4e/group__imgproc__c.html#ggaa491173a6b1628f4ff82067b2e1ceaa9a398508a98b3bf25bd1b9307ccba4e7dd">CV_BGR2GRAY</a>);</div>
<div class="line">    <a class="code" href="../../d7/d1b/group__imgproc__misc.html#gae8a4a146d1ca78c626a53577199e9c57">threshold</a>(bw, bw, 40, 255, <a class="code" href="../../df/d4e/group__imgproc__c.html#gga2dbb833ef0dcc466dd02ee76badaf709a6af8cb4caea50fb9578d4543aa7b6f20">CV_THRESH_BINARY</a> | <a class="code" href="../../df/d4e/group__imgproc__c.html#gga2dbb833ef0dcc466dd02ee76badaf709a2456934f4f01402e80006a317ea2693e">CV_THRESH_OTSU</a>);</div>
<div class="line">    <a class="code" href="../../d7/dfc/group__highgui.html#ga453d42fe4cb60e5723281a89973ee563">imshow</a>(<span class="stringliteral">&quot;Binary Image&quot;</span>, bw);</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Perform the distance transform algorithm</span></div>
<div class="line">    <a class="code" href="../../d3/d63/classcv_1_1Mat.html">Mat</a> dist;</div>
<div class="line">    <a class="code" href="../../d7/d1b/group__imgproc__misc.html#ga8a0b7fdfcb7a13dde018988ba3a43042">distanceTransform</a>(bw, dist, <a class="code" href="../../df/d4e/group__imgproc__c.html#gga9a3be2d66956bd67c0b66c32d8b30f17ae60a48ac6e8738abf6746c4beb4a9962">CV_DIST_L2</a>, 3);</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Normalize the distance image for range = {0.0, 1.0}</span></div>
<div class="line">    <span class="comment">// so we can visualize and threshold it</span></div>
<div class="line">    <a class="code" href="../../dc/d84/group__core__basic.html#ga1b6a396a456c8b6c6e4afd8591560d80">normalize</a>(dist, dist, 0, 1., <a class="code" href="../../d2/de8/group__core__array.html#ggad12cefbcb5291cf958a85b4b67b6149fa9f0c1c342a18114d47b516a88e29822e">NORM_MINMAX</a>);</div>
<div class="line">    <a class="code" href="../../d7/dfc/group__highgui.html#ga453d42fe4cb60e5723281a89973ee563">imshow</a>(<span class="stringliteral">&quot;Distance Transform Image&quot;</span>, dist);</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Threshold to obtain the peaks</span></div>
<div class="line">    <span class="comment">// This will be the markers for the foreground objects</span></div>
<div class="line">    <a class="code" href="../../d7/d1b/group__imgproc__misc.html#gae8a4a146d1ca78c626a53577199e9c57">threshold</a>(dist, dist, .4, 1., <a class="code" href="../../df/d4e/group__imgproc__c.html#gga2dbb833ef0dcc466dd02ee76badaf709a6af8cb4caea50fb9578d4543aa7b6f20">CV_THRESH_BINARY</a>);</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Dilate a bit the dist image</span></div>
<div class="line">    <a class="code" href="../../d3/d63/classcv_1_1Mat.html">Mat</a> kernel1 = Mat::ones(3, 3, <a class="code" href="../../dc/dcc/cvdef_8h.html#a81df635441b21f532fdace401e04f588">CV_8UC1</a>);</div>
<div class="line">    <a class="code" href="../../d4/d86/group__imgproc__filter.html#ga4ff0f3318642c4f469d0e11f242f3b6c">dilate</a>(dist, dist, kernel1);</div>
<div class="line">    <a class="code" href="../../d7/dfc/group__highgui.html#ga453d42fe4cb60e5723281a89973ee563">imshow</a>(<span class="stringliteral">&quot;Peaks&quot;</span>, dist);</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Create the CV_8U version of the distance image</span></div>
<div class="line">    <span class="comment">// It is needed for findContours()</span></div>
<div class="line">    <a class="code" href="../../d3/d63/classcv_1_1Mat.html">Mat</a> dist_8u;</div>
<div class="line">    dist.<a class="code" href="../../d3/d63/classcv_1_1Mat.html#a3f356665bb0ca452e7d7723ccac9a810">convertTo</a>(dist_8u, <a class="code" href="../../dc/dcc/cvdef_8h.html#a32b18d904ee2b1731a9416a8eef67d06">CV_8U</a>);</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Find total markers</span></div>
<div class="line">    vector&lt;vector&lt;Point&gt; &gt; contours;</div>
<div class="line">    <a class="code" href="../../d3/dc0/group__imgproc__shape.html#ga17ed9f5d79ae97bd4c7cf18403e1689a">findContours</a>(dist_8u, contours, <a class="code" href="../../df/d4e/group__imgproc__c.html#ggae33c78feb670de33d2abf21ec0624531a826a46df86827e600ae618c02dd83966">CV_RETR_EXTERNAL</a>, <a class="code" href="../../df/d4e/group__imgproc__c.html#gga950bf8e3371138ceb9649d45e9a96340a6b22208abd75cd6323903a0ae3d896ed">CV_CHAIN_APPROX_SIMPLE</a>);</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Create the marker image for the watershed algorithm</span></div>
<div class="line">    <a class="code" href="../../d3/d63/classcv_1_1Mat.html">Mat</a> markers = Mat::zeros(dist.<a class="code" href="../../d3/d63/classcv_1_1Mat.html#a146f8e8dda07d1365a575ab83d9828d1">size</a>(), <a class="code" href="../../dc/dcc/cvdef_8h.html#a32f03fbb8f73bff70215b77f5c3cac11">CV_32SC1</a>);</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Draw the foreground markers</span></div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; contours.size(); i++)</div>
<div class="line">        <a class="code" href="../../d6/d6e/group__imgproc__draw.html#ga746c0625f1781f1ffc9056259103edbc">drawContours</a>(markers, contours, static_cast&lt;int&gt;(i), Scalar::all(static_cast&lt;int&gt;(i)+1), -1);</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Draw the background marker</span></div>
<div class="line">    <a class="code" href="../../d6/d6e/group__imgproc__draw.html#gaf10604b069374903dbd0f0488cb43670">circle</a>(markers, <a class="code" href="../../dc/d84/group__core__basic.html#ga1e83eafb2d26b3c93f09e8338bcab192">Point</a>(5,5), 3, <a class="code" href="../../df/d4e/group__imgproc__c.html#ga16fe14b01ea8dffdf2405dc5534e5f15">CV_RGB</a>(255,255,255), -1);</div>
<div class="line">    <a class="code" href="../../d7/dfc/group__highgui.html#ga453d42fe4cb60e5723281a89973ee563">imshow</a>(<span class="stringliteral">&quot;Markers&quot;</span>, markers*10000);</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Perform the watershed algorithm</span></div>
<div class="line">    <a class="code" href="../../d7/d1b/group__imgproc__misc.html#ga3267243e4d3f95165d55a618c65ac6e1">watershed</a>(src, markers);</div>
<div class="line"></div>
<div class="line">    <a class="code" href="../../d3/d63/classcv_1_1Mat.html">Mat</a> mark = Mat::zeros(markers.<a class="code" href="../../d3/d63/classcv_1_1Mat.html#a146f8e8dda07d1365a575ab83d9828d1">size</a>(), <a class="code" href="../../dc/dcc/cvdef_8h.html#a81df635441b21f532fdace401e04f588">CV_8UC1</a>);</div>
<div class="line">    markers.<a class="code" href="../../d3/d63/classcv_1_1Mat.html#a3f356665bb0ca452e7d7723ccac9a810">convertTo</a>(mark, <a class="code" href="../../dc/dcc/cvdef_8h.html#a81df635441b21f532fdace401e04f588">CV_8UC1</a>);</div>
<div class="line">    <a class="code" href="../../d2/de8/group__core__array.html#ga0002cf8b418479f4cb49a75442baee2f">bitwise_not</a>(mark, mark);</div>
<div class="line"><span class="comment">//    imshow(&quot;Markers_v2&quot;, mark); // uncomment this if you want to see how the mark</span></div>
<div class="line">                                  <span class="comment">// image looks like at that point</span></div>
<div class="line"></div>
<div class="line">    <span class="comment">// Generate random colors</span></div>
<div class="line">    vector&lt;Vec3b&gt; colors;</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; contours.size(); i++)</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordtype">int</span> b = <a class="code" href="../../d2/de8/group__core__array.html#ga75843061d150ad6564b5447e38e57722">theRNG</a>().<a class="code" href="../../d1/dd6/classcv_1_1RNG.html#acde197860cea91e5aa896be8719457ae">uniform</a>(0, 255);</div>
<div class="line">        <span class="keywordtype">int</span> g = <a class="code" href="../../d2/de8/group__core__array.html#ga75843061d150ad6564b5447e38e57722">theRNG</a>().<a class="code" href="../../d1/dd6/classcv_1_1RNG.html#acde197860cea91e5aa896be8719457ae">uniform</a>(0, 255);</div>
<div class="line">        <span class="keywordtype">int</span> r = <a class="code" href="../../d2/de8/group__core__array.html#ga75843061d150ad6564b5447e38e57722">theRNG</a>().<a class="code" href="../../d1/dd6/classcv_1_1RNG.html#acde197860cea91e5aa896be8719457ae">uniform</a>(0, 255);</div>
<div class="line"></div>
<div class="line">        colors.push_back(<a class="code" href="../../dc/d84/group__core__basic.html#ga7e6060c0b8d48459964df6e1eb524c03">Vec3b</a>((<a class="code" href="../../d5/d64/defs_8h.html#a65f85814a8290f9797005d3b28e7e5fc">uchar</a>)b, (<a class="code" href="../../d5/d64/defs_8h.html#a65f85814a8290f9797005d3b28e7e5fc">uchar</a>)g, (<a class="code" href="../../d5/d64/defs_8h.html#a65f85814a8290f9797005d3b28e7e5fc">uchar</a>)r));</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Create the result image</span></div>
<div class="line">    <a class="code" href="../../d3/d63/classcv_1_1Mat.html">Mat</a> dst = Mat::zeros(markers.<a class="code" href="../../d3/d63/classcv_1_1Mat.html#a146f8e8dda07d1365a575ab83d9828d1">size</a>(), <a class="code" href="../../dc/dcc/cvdef_8h.html#a88c4cd9de76f678f33928ef1e3f96047">CV_8UC3</a>);</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Fill labeled objects with random colors</span></div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; markers.<a class="code" href="../../d3/d63/classcv_1_1Mat.html#abed816466c45234254d25bc59c31245e">rows</a>; i++)</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; markers.<a class="code" href="../../d3/d63/classcv_1_1Mat.html#aa3e5a47585c9ef6a0842556739155e3e">cols</a>; j++)</div>
<div class="line">        {</div>
<div class="line">            <span class="keywordtype">int</span> index = markers.<a class="code" href="../../d3/d63/classcv_1_1Mat.html#aa5d20fc86d41d59e4d71ae93daee9726">at</a>&lt;<span class="keywordtype">int</span>&gt;(i,j);</div>
<div class="line">            <span class="keywordflow">if</span> (index &gt; 0 &amp;&amp; index &lt;= static_cast&lt;int&gt;(contours.size()))</div>
<div class="line">                dst.<a class="code" href="../../d3/d63/classcv_1_1Mat.html#aa5d20fc86d41d59e4d71ae93daee9726">at</a>&lt;<a class="code" href="../../d6/dcf/classcv_1_1Vec.html">Vec3b</a>&gt;(i,j) = colors[index-1];</div>
<div class="line">            <span class="keywordflow">else</span></div>
<div class="line">                dst.<a class="code" href="../../d3/d63/classcv_1_1Mat.html#aa5d20fc86d41d59e4d71ae93daee9726">at</a>&lt;<a class="code" href="../../d6/dcf/classcv_1_1Vec.html">Vec3b</a>&gt;(i,j) = <a class="code" href="../../dc/d84/group__core__basic.html#ga7e6060c0b8d48459964df6e1eb524c03">Vec3b</a>(0,0,0);</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Visualize the final image</span></div>
<div class="line">    <a class="code" href="../../d7/dfc/group__highgui.html#ga453d42fe4cb60e5723281a89973ee563">imshow</a>(<span class="stringliteral">&quot;Final Result&quot;</span>, dst);</div>
<div class="line"></div>
<div class="line">    <a class="code" href="../../d7/dfc/group__highgui.html#ga5628525ad33f52eab17feebcfba38bd7">waitKey</a>(0);</div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
</div><!-- fragment --><h2>Explanation / Result </h2>
<ol type="1">
<li>Load the source image and check if it is loaded without any problem, then show it: <div class="fragment"><div class="line">    <span class="comment">// Load the image</span></div>
<div class="line">    Mat src = <a class="code" href="../../d4/da8/group__imgcodecs.html#ga288b8b3da0892bd651fce07b3bbd3a56">imread</a>(argv[1]);</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Check if everything was fine</span></div>
<div class="line">    <span class="keywordflow">if</span> (!src.data)</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Show source image</span></div>
<div class="line">    <a class="code" href="../../d7/dfc/group__highgui.html#ga453d42fe4cb60e5723281a89973ee563">imshow</a>(<span class="stringliteral">&quot;Source Image&quot;</span>, src);</div>
</div><!-- fragment --> <div class="image">
<img src="../../source.jpeg" alt="source.jpeg"/>
</div>
</li>
<li>Then if we have an image with white background, it is good to tranform it black. This will help us to desciminate the foreground objects easier when we will apply the Distance Transform: <div class="fragment"><div class="line">    <span class="comment">// Change the background from white to black, since that will help later to extract</span></div>
<div class="line">    <span class="comment">// better results during the use of Distance Transform</span></div>
<div class="line">    <span class="keywordflow">for</span>( <span class="keywordtype">int</span> x = 0; x &lt; src.rows; x++ ) {</div>
<div class="line">      <span class="keywordflow">for</span>( <span class="keywordtype">int</span> y = 0; y &lt; src.<a class="code" href="../../de/de1/classcv_1_1Matx.html#a1828fc4421f037a80fdb750eeedcb60ca0be112b36f43fbfe06e8f9d1361f51b6">cols</a>; y++ ) {</div>
<div class="line">          <span class="keywordflow">if</span> ( src.at&lt;<a class="code" href="../../dc/d84/group__core__basic.html#ga7e6060c0b8d48459964df6e1eb524c03">Vec3b</a>&gt;(x, y) == <a class="code" href="../../dc/d84/group__core__basic.html#ga7e6060c0b8d48459964df6e1eb524c03">Vec3b</a>(255,255,255) ) {</div>
<div class="line">            src.at&lt;<a class="code" href="../../dc/d84/group__core__basic.html#ga7e6060c0b8d48459964df6e1eb524c03">Vec3b</a>&gt;(x, y)[0] = 0;</div>
<div class="line">            src.at&lt;<a class="code" href="../../dc/d84/group__core__basic.html#ga7e6060c0b8d48459964df6e1eb524c03">Vec3b</a>&gt;(x, y)[1] = 0;</div>
<div class="line">            src.at&lt;<a class="code" href="../../dc/d84/group__core__basic.html#ga7e6060c0b8d48459964df6e1eb524c03">Vec3b</a>&gt;(x, y)[2] = 0;</div>
<div class="line">          }</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Show output image</span></div>
<div class="line">    <a class="code" href="../../d7/dfc/group__highgui.html#ga453d42fe4cb60e5723281a89973ee563">imshow</a>(<span class="stringliteral">&quot;Black Background Image&quot;</span>, src);</div>
</div><!-- fragment --> <div class="image">
<img src="../../black_bg.jpeg" alt="black_bg.jpeg"/>
</div>
</li>
<li>Afterwards we will sharp our image in order to acute the edges of the foreground objects. We will apply a laplacian filter with a quite strong filter (an approximation of second derivative): <div class="fragment"><div class="line">    <span class="comment">// Create a kernel that we will use for accuting/sharpening our image</span></div>
<div class="line">    Mat kernel = (Mat_&lt;float&gt;(3,3) &lt;&lt;</div>
<div class="line">            1,  1, 1,</div>
<div class="line">            1, -8, 1,</div>
<div class="line">            1,  1, 1); <span class="comment">// an approximation of second derivative, a quite strong kernel</span></div>
<div class="line"></div>
<div class="line">    <span class="comment">// do the laplacian filtering as it is</span></div>
<div class="line">    <span class="comment">// well, we need to convert everything in something more deeper then CV_8U</span></div>
<div class="line">    <span class="comment">// because the kernel has some negative values,</span></div>
<div class="line">    <span class="comment">// and we can expect in general to have a Laplacian image with negative values</span></div>
<div class="line">    <span class="comment">// BUT a 8bits unsigned int (the one we are working with) can contain values from 0 to 255</span></div>
<div class="line">    <span class="comment">// so the possible negative number will be truncated</span></div>
<div class="line">    Mat imgLaplacian;</div>
<div class="line">    Mat sharp = src; <span class="comment">// copy source image to another temporary one</span></div>
<div class="line">    <a class="code" href="../../d4/d86/group__imgproc__filter.html#ga27c049795ce870216ddfb366086b5a04">filter2D</a>(sharp, imgLaplacian, <a class="code" href="../../dc/dcc/cvdef_8h.html#a4a3def5d72b74bed31f5f8ab7676099c">CV_32F</a>, kernel);</div>
<div class="line">    src.convertTo(sharp, <a class="code" href="../../dc/dcc/cvdef_8h.html#a4a3def5d72b74bed31f5f8ab7676099c">CV_32F</a>);</div>
<div class="line">    Mat imgResult = sharp - imgLaplacian;</div>
<div class="line"></div>
<div class="line">    <span class="comment">// convert back to 8bits gray scale</span></div>
<div class="line">    imgResult.<a class="code" href="../../d3/d63/classcv_1_1Mat.html#a3f356665bb0ca452e7d7723ccac9a810">convertTo</a>(imgResult, <a class="code" href="../../dc/dcc/cvdef_8h.html#a88c4cd9de76f678f33928ef1e3f96047">CV_8UC3</a>);</div>
<div class="line">    imgLaplacian.convertTo(imgLaplacian, <a class="code" href="../../dc/dcc/cvdef_8h.html#a88c4cd9de76f678f33928ef1e3f96047">CV_8UC3</a>);</div>
<div class="line"></div>
<div class="line">    <span class="comment">// imshow( &quot;Laplace Filtered Image&quot;, imgLaplacian );</span></div>
<div class="line">    <a class="code" href="../../d7/dfc/group__highgui.html#ga453d42fe4cb60e5723281a89973ee563">imshow</a>( <span class="stringliteral">&quot;New Sharped Image&quot;</span>, imgResult );</div>
</div><!-- fragment --> <div class="image">
<img src="../../laplace.jpeg" alt="laplace.jpeg"/>
</div>
 <div class="image">
<img src="../../sharp.jpeg" alt="sharp.jpeg"/>
</div>
</li>
<li>Now we tranfrom our new sharped source image to a grayscale and a binary one, respectively: <div class="fragment"><div class="line">    <span class="comment">// Create binary image from source image</span></div>
<div class="line">    Mat bw;</div>
<div class="line">    <a class="code" href="../../d7/d1b/group__imgproc__misc.html#ga397ae87e1288a81d2363b61574eb8cab">cvtColor</a>(src, bw, <a class="code" href="../../df/d4e/group__imgproc__c.html#ggaa491173a6b1628f4ff82067b2e1ceaa9a398508a98b3bf25bd1b9307ccba4e7dd">CV_BGR2GRAY</a>);</div>
<div class="line">    <a class="code" href="../../d7/d1b/group__imgproc__misc.html#gae8a4a146d1ca78c626a53577199e9c57">threshold</a>(bw, bw, 40, 255, <a class="code" href="../../df/d4e/group__imgproc__c.html#gga2dbb833ef0dcc466dd02ee76badaf709a6af8cb4caea50fb9578d4543aa7b6f20">CV_THRESH_BINARY</a> | <a class="code" href="../../df/d4e/group__imgproc__c.html#gga2dbb833ef0dcc466dd02ee76badaf709a2456934f4f01402e80006a317ea2693e">CV_THRESH_OTSU</a>);</div>
<div class="line">    <a class="code" href="../../d7/dfc/group__highgui.html#ga453d42fe4cb60e5723281a89973ee563">imshow</a>(<span class="stringliteral">&quot;Binary Image&quot;</span>, bw);</div>
</div><!-- fragment --> <div class="image">
<img src="../../bin.jpeg" alt="bin.jpeg"/>
</div>
</li>
<li>We are ready now to apply the Distance Tranform on the binary image. Moreover, we normalize the output image in order to be able visualize and threshold the result: <div class="fragment"><div class="line">    <span class="comment">// Perform the distance transform algorithm</span></div>
<div class="line">    Mat dist;</div>
<div class="line">    <a class="code" href="../../d7/d1b/group__imgproc__misc.html#ga8a0b7fdfcb7a13dde018988ba3a43042">distanceTransform</a>(bw, dist, <a class="code" href="../../df/d4e/group__imgproc__c.html#gga9a3be2d66956bd67c0b66c32d8b30f17ae60a48ac6e8738abf6746c4beb4a9962">CV_DIST_L2</a>, 3);</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Normalize the distance image for range = {0.0, 1.0}</span></div>
<div class="line">    <span class="comment">// so we can visualize and threshold it</span></div>
<div class="line">    <a class="code" href="../../dc/d84/group__core__basic.html#ga1b6a396a456c8b6c6e4afd8591560d80">normalize</a>(dist, dist, 0, 1., <a class="code" href="../../d2/de8/group__core__array.html#ggad12cefbcb5291cf958a85b4b67b6149fa9f0c1c342a18114d47b516a88e29822e">NORM_MINMAX</a>);</div>
<div class="line">    <a class="code" href="../../d7/dfc/group__highgui.html#ga453d42fe4cb60e5723281a89973ee563">imshow</a>(<span class="stringliteral">&quot;Distance Transform Image&quot;</span>, dist);</div>
</div><!-- fragment --> <div class="image">
<img src="../../dist_transf.jpeg" alt="dist_transf.jpeg"/>
</div>
</li>
<li>We threshold the <em>dist</em> image and then perform some morphology operation (i.e. dilation) in order to extract the peaks from the above image: <div class="fragment"><div class="line">    <span class="comment">// Threshold to obtain the peaks</span></div>
<div class="line">    <span class="comment">// This will be the markers for the foreground objects</span></div>
<div class="line">    <a class="code" href="../../d7/d1b/group__imgproc__misc.html#gae8a4a146d1ca78c626a53577199e9c57">threshold</a>(dist, dist, .4, 1., <a class="code" href="../../df/d4e/group__imgproc__c.html#gga2dbb833ef0dcc466dd02ee76badaf709a6af8cb4caea50fb9578d4543aa7b6f20">CV_THRESH_BINARY</a>);</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Dilate a bit the dist image</span></div>
<div class="line">    Mat kernel1 = Mat::ones(3, 3, <a class="code" href="../../dc/dcc/cvdef_8h.html#a81df635441b21f532fdace401e04f588">CV_8UC1</a>);</div>
<div class="line">    <a class="code" href="../../d4/d86/group__imgproc__filter.html#ga4ff0f3318642c4f469d0e11f242f3b6c">dilate</a>(dist, dist, kernel1);</div>
<div class="line">    <a class="code" href="../../d7/dfc/group__highgui.html#ga453d42fe4cb60e5723281a89973ee563">imshow</a>(<span class="stringliteral">&quot;Peaks&quot;</span>, dist);</div>
</div><!-- fragment --> <div class="image">
<img src="../../peaks.jpeg" alt="peaks.jpeg"/>
</div>
</li>
<li>From each blob then we create a seed/marker for the watershed algorithm with the help of the <a class="el" href="../../d3/dc0/group__imgproc__shape.html#ga17ed9f5d79ae97bd4c7cf18403e1689a">cv::findContours</a> function: <div class="fragment"><div class="line">    <span class="comment">// Create the CV_8U version of the distance image</span></div>
<div class="line">    <span class="comment">// It is needed for findContours()</span></div>
<div class="line">    Mat dist_8u;</div>
<div class="line">    dist.<a class="code" href="../../d3/d63/classcv_1_1Mat.html#a3f356665bb0ca452e7d7723ccac9a810">convertTo</a>(dist_8u, <a class="code" href="../../dc/dcc/cvdef_8h.html#a32b18d904ee2b1731a9416a8eef67d06">CV_8U</a>);</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Find total markers</span></div>
<div class="line">    vector&lt;vector&lt;Point&gt; &gt; contours;</div>
<div class="line">    <a class="code" href="../../d3/dc0/group__imgproc__shape.html#ga17ed9f5d79ae97bd4c7cf18403e1689a">findContours</a>(dist_8u, contours, <a class="code" href="../../df/d4e/group__imgproc__c.html#ggae33c78feb670de33d2abf21ec0624531a826a46df86827e600ae618c02dd83966">CV_RETR_EXTERNAL</a>, <a class="code" href="../../df/d4e/group__imgproc__c.html#gga950bf8e3371138ceb9649d45e9a96340a6b22208abd75cd6323903a0ae3d896ed">CV_CHAIN_APPROX_SIMPLE</a>);</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Create the marker image for the watershed algorithm</span></div>
<div class="line">    Mat markers = Mat::zeros(dist.size(), <a class="code" href="../../dc/dcc/cvdef_8h.html#a32f03fbb8f73bff70215b77f5c3cac11">CV_32SC1</a>);</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Draw the foreground markers</span></div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; contours.size(); i++)</div>
<div class="line">        <a class="code" href="../../d6/d6e/group__imgproc__draw.html#ga746c0625f1781f1ffc9056259103edbc">drawContours</a>(markers, contours, static_cast&lt;int&gt;(i), Scalar::all(static_cast&lt;int&gt;(i)+1), -1);</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Draw the background marker</span></div>
<div class="line">    <a class="code" href="../../d6/d6e/group__imgproc__draw.html#gaf10604b069374903dbd0f0488cb43670">circle</a>(markers, <a class="code" href="../../dc/d84/group__core__basic.html#ga1e83eafb2d26b3c93f09e8338bcab192">Point</a>(5,5), 3, <a class="code" href="../../df/d4e/group__imgproc__c.html#ga16fe14b01ea8dffdf2405dc5534e5f15">CV_RGB</a>(255,255,255), -1);</div>
<div class="line">    <a class="code" href="../../d7/dfc/group__highgui.html#ga453d42fe4cb60e5723281a89973ee563">imshow</a>(<span class="stringliteral">&quot;Markers&quot;</span>, markers*10000);</div>
</div><!-- fragment --> <div class="image">
<img src="../../markers.jpeg" alt="markers.jpeg"/>
</div>
</li>
<li>Finally, we can apply the watershed algorithm, and visualize the result: <div class="fragment"><div class="line">    <span class="comment">// Perform the watershed algorithm</span></div>
<div class="line">    <a class="code" href="../../d7/d1b/group__imgproc__misc.html#ga3267243e4d3f95165d55a618c65ac6e1">watershed</a>(src, markers);</div>
<div class="line"></div>
<div class="line">    Mat mark = Mat::zeros(markers.size(), <a class="code" href="../../dc/dcc/cvdef_8h.html#a81df635441b21f532fdace401e04f588">CV_8UC1</a>);</div>
<div class="line">    markers.<a class="code" href="../../d3/d63/classcv_1_1Mat.html#a3f356665bb0ca452e7d7723ccac9a810">convertTo</a>(mark, <a class="code" href="../../dc/dcc/cvdef_8h.html#a81df635441b21f532fdace401e04f588">CV_8UC1</a>);</div>
<div class="line">    <a class="code" href="../../d2/de8/group__core__array.html#ga0002cf8b418479f4cb49a75442baee2f">bitwise_not</a>(mark, mark);</div>
<div class="line"><span class="comment">//    imshow(&quot;Markers_v2&quot;, mark); // uncomment this if you want to see how the mark</span></div>
<div class="line">                                  <span class="comment">// image looks like at that point</span></div>
<div class="line"></div>
<div class="line">    <span class="comment">// Generate random colors</span></div>
<div class="line">    vector&lt;Vec3b&gt; colors;</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; contours.size(); i++)</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordtype">int</span> b = <a class="code" href="../../d2/de8/group__core__array.html#ga75843061d150ad6564b5447e38e57722">theRNG</a>().<a class="code" href="../../d1/dd6/classcv_1_1RNG.html#acde197860cea91e5aa896be8719457ae">uniform</a>(0, 255);</div>
<div class="line">        <span class="keywordtype">int</span> g = <a class="code" href="../../d2/de8/group__core__array.html#ga75843061d150ad6564b5447e38e57722">theRNG</a>().<a class="code" href="../../d1/dd6/classcv_1_1RNG.html#acde197860cea91e5aa896be8719457ae">uniform</a>(0, 255);</div>
<div class="line">        <span class="keywordtype">int</span> r = <a class="code" href="../../d2/de8/group__core__array.html#ga75843061d150ad6564b5447e38e57722">theRNG</a>().<a class="code" href="../../d1/dd6/classcv_1_1RNG.html#acde197860cea91e5aa896be8719457ae">uniform</a>(0, 255);</div>
<div class="line"></div>
<div class="line">        colors.push_back(<a class="code" href="../../dc/d84/group__core__basic.html#ga7e6060c0b8d48459964df6e1eb524c03">Vec3b</a>((<a class="code" href="../../d5/d64/defs_8h.html#a65f85814a8290f9797005d3b28e7e5fc">uchar</a>)b, (<a class="code" href="../../d5/d64/defs_8h.html#a65f85814a8290f9797005d3b28e7e5fc">uchar</a>)g, (<a class="code" href="../../d5/d64/defs_8h.html#a65f85814a8290f9797005d3b28e7e5fc">uchar</a>)r));</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Create the result image</span></div>
<div class="line">    Mat dst = Mat::zeros(markers.size(), <a class="code" href="../../dc/dcc/cvdef_8h.html#a88c4cd9de76f678f33928ef1e3f96047">CV_8UC3</a>);</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Fill labeled objects with random colors</span></div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; markers.rows; i++)</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; markers.cols; j++)</div>
<div class="line">        {</div>
<div class="line">            <span class="keywordtype">int</span> index = markers.<a class="code" href="../../d3/d63/classcv_1_1Mat.html#aa5d20fc86d41d59e4d71ae93daee9726">at</a>&lt;<span class="keywordtype">int</span>&gt;(i,j);</div>
<div class="line">            <span class="keywordflow">if</span> (index &gt; 0 &amp;&amp; index &lt;= static_cast&lt;int&gt;(contours.size()))</div>
<div class="line">                dst.at&lt;<a class="code" href="../../dc/d84/group__core__basic.html#ga7e6060c0b8d48459964df6e1eb524c03">Vec3b</a>&gt;(i,j) = colors[index-1];</div>
<div class="line">            <span class="keywordflow">else</span></div>
<div class="line">                dst.at&lt;<a class="code" href="../../dc/d84/group__core__basic.html#ga7e6060c0b8d48459964df6e1eb524c03">Vec3b</a>&gt;(i,j) = <a class="code" href="../../dc/d84/group__core__basic.html#ga7e6060c0b8d48459964df6e1eb524c03">Vec3b</a>(0,0,0);</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Visualize the final image</span></div>
<div class="line">    <a class="code" href="../../d7/dfc/group__highgui.html#ga453d42fe4cb60e5723281a89973ee563">imshow</a>(<span class="stringliteral">&quot;Final Result&quot;</span>, dst);</div>
</div><!-- fragment --> <div class="image">
<img src="../../final.jpeg" alt="final.jpeg"/>
</div>
 </li>
</ol>
</div></div><!-- contents -->
<!-- HTML footer for doxygen 1.8.6-->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Sat Jun 20 2015 13:08:39 for OpenCV by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/>
</a> 1.8.6
</small></address>
</body>
</html>
