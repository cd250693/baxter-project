<!-- HTML header for doxygen 1.8.6-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>OpenCV: How to Use Background Subtraction Methods</title>
<link href="../../opencv.ico" rel="shortcut icon" type="image/x-icon" />
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js", "TeX/AMSmath.js", "TeX/AMSsymbols.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
MathJax.Hub.Config(
{
  TeX: {
      Macros: {
          matTT: [ "\\[ \\left|\\begin{array}{ccc} #1 & #2 & #3\\\\ #4 & #5 & #6\\\\ #7 & #8 & #9 \\end{array}\\right| \\]", 9],
          fork: ["\\left\\{ \\begin{array}{l l} #1 & \\mbox{#2}\\\\ #3 & \\mbox{#4}\\\\ \\end{array} \\right.", 4],
          forkthree: ["\\left\\{ \\begin{array}{l l} #1 & \\mbox{#2}\\\\ #3 & \\mbox{#4}\\\\ #5 & \\mbox{#6}\\\\ \\end{array} \\right.", 6],
          vecthree: ["\\begin{bmatrix} #1\\\\ #2\\\\ #3 \\end{bmatrix}", 3],
          vecthreethree: ["\\begin{bmatrix} #1 & #2 & #3\\\\ #4 & #5 & #6\\\\ #7 & #8 & #9 \\end{bmatrix}", 9],
          hdotsfor: ["\\dots", 1],
          mathbbm: ["\\mathbb{#1}", 1],
          bordermatrix: ["\\matrix{#1}", 1]
      }
  }
}
);
</script><script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="../../stylesheet.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="../../opencv-logo-small.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">OpenCV
   &#160;<span id="projectnumber">3.0.0</span>
   </div>
   <div id="projectbrief">Open Source Computer Vision</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="../../pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="../../modules.html"><span>Modules</span></a></li>
      <li><a href="../../namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="../../annotated.html"><span>Classes</span></a></li>
      <li><a href="../../files.html"><span>Files</span></a></li>
      <li><a href="../../examples.html"><span>Examples</span></a></li>
      <li><a href="../..//3.0-last-rst"><span>Sphinx&#160;Documentation</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="../../search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="../../search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Properties</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(11)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(12)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(13)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="../../d9/df8/tutorial_root.html">OpenCV Tutorials</a></li><li class="navelem"><a class="el" href="../../da/dd0/tutorial_table_of_content_video.html">Video analysis (video module)</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">How to Use Background Subtraction Methods </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><ul>
<li>Background subtraction (BS) is a common and widely used technique for generating a foreground mask (namely, a binary image containing the pixels belonging to moving objects in the scene) by using static cameras.</li>
<li><p class="startli">As the name suggests, BS calculates the foreground mask performing a subtraction between the current frame and a background model, containing the static part of the scene or, more in general, everything that can be considered as background given the characteristics of the observed scene.</p>
<div class="image">
<img src="../../Background_Subtraction_Tutorial_Scheme.png" alt="Background_Subtraction_Tutorial_Scheme.png"/>
</div>
</li>
<li><p class="startli">Background modeling consists of two main steps:</p>
<ol type="1">
<li>Background Initialization;</li>
<li>Background Update.</li>
</ol>
<p class="startli">In the first step, an initial model of the background is computed, while in the second step that model is updated in order to adapt to possible changes in the scene.</p>
</li>
<li>In this tutorial we will learn how to perform BS by using OpenCV. As input, we will use data coming from the publicly available data set <a href="http://bmc.univ-bpclermont.fr/">Background Models Challenge (BMC)</a> .</li>
</ul>
<h2>Goals </h2>
<p>In this tutorial you will learn how to:</p>
<ol type="1">
<li>Read data from videos by using <a class="el" href="../../d8/dfe/classcv_1_1VideoCapture.html">cv::VideoCapture</a> or image sequences by using <a class="el" href="../../d4/da8/group__imgcodecs.html#ga288b8b3da0892bd651fce07b3bbd3a56">cv::imread</a> ;</li>
<li>Create and update the background model by using <a class="el" href="../../d7/df6/classcv_1_1BackgroundSubtractor.html">cv::BackgroundSubtractor</a> class;</li>
<li>Get and show the foreground mask by using <a class="el" href="../../d7/dfc/group__highgui.html#ga453d42fe4cb60e5723281a89973ee563">cv::imshow</a> ;</li>
<li>Save the output by using <a class="el" href="../../d4/da8/group__imgcodecs.html#gabbc7ef1aa2edfaa87772f1202d67e0ce">cv::imwrite</a> to quantitatively evaluate the results.</li>
</ol>
<h2>Code </h2>
<p>In the following you can find the source code. We will let the user chose to process either a video file or a sequence of images.</p>
<p>Two different methods are used to generate two foreground masks:</p>
<ol type="1">
<li>cv::bgsegm::BackgroundSubtractorMOG</li>
<li><a class="el" href="../../d7/d7b/classcv_1_1BackgroundSubtractorMOG2.html">cv::BackgroundSubtractorMOG2</a></li>
</ol>
<p>The results as well as the input data are shown on the screen. The source file can be downloaded <a href="https://github.com/Itseez/opencv/tree/master/samples/cpp/tutorial_code/video/bg_sub.cpp">here</a>.</p>
<div class="fragment"><div class="line"></div>
<div class="line"><span class="comment">//opencv</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="../../d6/d87/imgcodecs_8hpp.html">opencv2/imgcodecs.hpp</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="../../dd/d46/imgproc_8hpp.html">opencv2/imgproc.hpp</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="../../dc/d3d/videoio_8hpp.html">opencv2/videoio.hpp</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="../../d4/dd5/highgui_8hpp.html">opencv2/highgui.hpp</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="../../d5/d71/video_8hpp.html">opencv2/video.hpp</a>&gt;</span></div>
<div class="line"><span class="comment">//C</span></div>
<div class="line"><span class="preprocessor">#include &lt;stdio.h&gt;</span></div>
<div class="line"><span class="comment">//C++</span></div>
<div class="line"><span class="preprocessor">#include &lt;iostream&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;sstream&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="keyword">using namespace </span>cv;</div>
<div class="line"><span class="keyword">using namespace </span>std;</div>
<div class="line"></div>
<div class="line"><span class="comment">// Global variables</span></div>
<div class="line">Mat frame; <span class="comment">//current frame</span></div>
<div class="line">Mat fgMaskMOG2; <span class="comment">//fg mask fg mask generated by MOG2 method</span></div>
<div class="line"><a class="code" href="../../d0/de7/structcv_1_1Ptr.html">Ptr&lt;BackgroundSubtractor&gt;</a> pMOG2; <span class="comment">//MOG2 Background subtractor</span></div>
<div class="line"><span class="keywordtype">int</span> keyboard; <span class="comment">//input from keyboard</span></div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> help();</div>
<div class="line"><span class="keywordtype">void</span> processVideo(<span class="keywordtype">char</span>* videoFilename);</div>
<div class="line"><span class="keywordtype">void</span> processImages(<span class="keywordtype">char</span>* firstFrameFilename);</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> help()</div>
<div class="line">{</div>
<div class="line">    cout</div>
<div class="line">    &lt;&lt; <span class="stringliteral">&quot;--------------------------------------------------------------------------&quot;</span> &lt;&lt; endl</div>
<div class="line">    &lt;&lt; <span class="stringliteral">&quot;This program shows how to use background subtraction methods provided by &quot;</span>  &lt;&lt; endl</div>
<div class="line">    &lt;&lt; <span class="stringliteral">&quot; OpenCV. You can process both videos (-vid) and images (-img).&quot;</span>             &lt;&lt; endl</div>
<div class="line">                                                                                    &lt;&lt; endl</div>
<div class="line">    &lt;&lt; <span class="stringliteral">&quot;Usage:&quot;</span>                                                                     &lt;&lt; endl</div>
<div class="line">    &lt;&lt; <span class="stringliteral">&quot;./bs {-vid &lt;video filename&gt;|-img &lt;image filename&gt;}&quot;</span>                         &lt;&lt; endl</div>
<div class="line">    &lt;&lt; <span class="stringliteral">&quot;for example: ./bs -vid video.avi&quot;</span>                                           &lt;&lt; endl</div>
<div class="line">    &lt;&lt; <span class="stringliteral">&quot;or: ./bs -img /data/images/1.png&quot;</span>                                           &lt;&lt; endl</div>
<div class="line">    &lt;&lt; <span class="stringliteral">&quot;--------------------------------------------------------------------------&quot;</span> &lt;&lt; endl</div>
<div class="line">    &lt;&lt; endl;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span>* argv[])</div>
<div class="line">{</div>
<div class="line">    <span class="comment">//print help information</span></div>
<div class="line">    help();</div>
<div class="line"></div>
<div class="line">    <span class="comment">//check for the input parameter correctness</span></div>
<div class="line">    <span class="keywordflow">if</span>(argc != 3) {</div>
<div class="line">        cerr &lt;&lt;<span class="stringliteral">&quot;Incorret input list&quot;</span> &lt;&lt; endl;</div>
<div class="line">        cerr &lt;&lt;<span class="stringliteral">&quot;exiting...&quot;</span> &lt;&lt; endl;</div>
<div class="line">        <span class="keywordflow">return</span> EXIT_FAILURE;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">//create GUI windows</span></div>
<div class="line">    <a class="code" href="../../d7/dfc/group__highgui.html#ga5afdf8410934fd099df85c75b2e0888b">namedWindow</a>(<span class="stringliteral">&quot;Frame&quot;</span>);</div>
<div class="line">    <a class="code" href="../../d7/dfc/group__highgui.html#ga5afdf8410934fd099df85c75b2e0888b">namedWindow</a>(<span class="stringliteral">&quot;FG Mask MOG 2&quot;</span>);</div>
<div class="line"></div>
<div class="line">    <span class="comment">//create Background Subtractor objects</span></div>
<div class="line">    pMOG2 = <a class="code" href="../../de/de1/group__video__motion.html#ga2beb2dee7a073809ccec60f145b6b29c">createBackgroundSubtractorMOG2</a>(); <span class="comment">//MOG2 approach</span></div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span>(strcmp(argv[1], <span class="stringliteral">&quot;-vid&quot;</span>) == 0) {</div>
<div class="line">        <span class="comment">//input data coming from a video</span></div>
<div class="line">        processVideo(argv[2]);</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(strcmp(argv[1], <span class="stringliteral">&quot;-img&quot;</span>) == 0) {</div>
<div class="line">        <span class="comment">//input data coming from a sequence of images</span></div>
<div class="line">        processImages(argv[2]);</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span> {</div>
<div class="line">        <span class="comment">//error in reading input parameters</span></div>
<div class="line">        cerr &lt;&lt;<span class="stringliteral">&quot;Please, check the input parameters.&quot;</span> &lt;&lt; endl;</div>
<div class="line">        cerr &lt;&lt;<span class="stringliteral">&quot;Exiting...&quot;</span> &lt;&lt; endl;</div>
<div class="line">        <span class="keywordflow">return</span> EXIT_FAILURE;</div>
<div class="line">    }</div>
<div class="line">    <span class="comment">//destroy GUI windows</span></div>
<div class="line">    <a class="code" href="../../d7/dfc/group__highgui.html#ga6b7fc1c1a8960438156912027b38f481">destroyAllWindows</a>();</div>
<div class="line">    <span class="keywordflow">return</span> EXIT_SUCCESS;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> processVideo(<span class="keywordtype">char</span>* videoFilename) {</div>
<div class="line">    <span class="comment">//create the capture object</span></div>
<div class="line">    <a class="code" href="../../d8/dfe/classcv_1_1VideoCapture.html">VideoCapture</a> capture(videoFilename);</div>
<div class="line">    <span class="keywordflow">if</span>(!capture.<a class="code" href="../../d8/dfe/classcv_1_1VideoCapture.html#ad62969b4aaa492f9ed021263d1a42f1b">isOpened</a>()){</div>
<div class="line">        <span class="comment">//error in opening the video input</span></div>
<div class="line">        cerr &lt;&lt; <span class="stringliteral">&quot;Unable to open video file: &quot;</span> &lt;&lt; videoFilename &lt;&lt; endl;</div>
<div class="line">        exit(EXIT_FAILURE);</div>
<div class="line">    }</div>
<div class="line">    <span class="comment">//read input data. ESC or &#39;q&#39; for quitting</span></div>
<div class="line">    <span class="keywordflow">while</span>( (<span class="keywordtype">char</span>)keyboard != <span class="charliteral">&#39;q&#39;</span> &amp;&amp; (<span class="keywordtype">char</span>)keyboard != 27 ){</div>
<div class="line">        <span class="comment">//read the current frame</span></div>
<div class="line">        <span class="keywordflow">if</span>(!capture.<a class="code" href="../../d8/dfe/classcv_1_1VideoCapture.html#a473055e77dd7faa4d26d686226b292c1">read</a>(frame)) {</div>
<div class="line">            cerr &lt;&lt; <span class="stringliteral">&quot;Unable to read next frame.&quot;</span> &lt;&lt; endl;</div>
<div class="line">            cerr &lt;&lt; <span class="stringliteral">&quot;Exiting...&quot;</span> &lt;&lt; endl;</div>
<div class="line">            exit(EXIT_FAILURE);</div>
<div class="line">        }</div>
<div class="line">        <span class="comment">//update the background model</span></div>
<div class="line">        pMOG2-&gt;apply(frame, fgMaskMOG2);</div>
<div class="line">        <span class="comment">//get the frame number and write it on the current frame</span></div>
<div class="line">        stringstream ss;</div>
<div class="line">        <a class="code" href="../../d6/d6e/group__imgproc__draw.html#ga07d2f74cadcf8e305e810ce8eed13bc9">rectangle</a>(frame, <a class="code" href="../../db/d4e/classcv_1_1Point__.html">cv::Point</a>(10, 2), <a class="code" href="../../db/d4e/classcv_1_1Point__.html">cv::Point</a>(100,20),</div>
<div class="line">                  <a class="code" href="../../d1/da0/classcv_1_1Scalar__.html">cv::Scalar</a>(255,255,255), -1);</div>
<div class="line">        ss &lt;&lt; capture.<a class="code" href="../../d8/dfe/classcv_1_1VideoCapture.html#aeb1644641842e6b104f244f049648f94">get</a>(<a class="code" href="../../dd/de7/group__videoio.html#gga04495204613753c836e07d31c575bf3ba6223452891755166a4fd5173ea257068">CAP_PROP_POS_FRAMES</a>);</div>
<div class="line">        <span class="keywordtype">string</span> frameNumberString = ss.str();</div>
<div class="line">        <a class="code" href="../../d6/d6e/group__imgproc__draw.html#ga5126f47f883d730f633d74f07456c576">putText</a>(frame, frameNumberString.c_str(), <a class="code" href="../../dc/d84/group__core__basic.html#ga1e83eafb2d26b3c93f09e8338bcab192">cv::Point</a>(15, 15),</div>
<div class="line">                <a class="code" href="../../d0/de1/group__core.html#gga0f9314ea6e35f99bb23f29567fc16e11afff8b973668df2e4028dddc5274310c9">FONT_HERSHEY_SIMPLEX</a>, 0.5 , <a class="code" href="../../dc/d84/group__core__basic.html#ga599fe92e910c027be274233eccad7beb">cv::Scalar</a>(0,0,0));</div>
<div class="line">        <span class="comment">//show the current frame and the fg masks</span></div>
<div class="line">        <a class="code" href="../../d7/dfc/group__highgui.html#ga453d42fe4cb60e5723281a89973ee563">imshow</a>(<span class="stringliteral">&quot;Frame&quot;</span>, frame);</div>
<div class="line">        <a class="code" href="../../d7/dfc/group__highgui.html#ga453d42fe4cb60e5723281a89973ee563">imshow</a>(<span class="stringliteral">&quot;FG Mask MOG 2&quot;</span>, fgMaskMOG2);</div>
<div class="line">        <span class="comment">//get the input from the keyboard</span></div>
<div class="line">        keyboard = <a class="code" href="../../d7/dfc/group__highgui.html#ga5628525ad33f52eab17feebcfba38bd7">waitKey</a>( 30 );</div>
<div class="line">    }</div>
<div class="line">    <span class="comment">//delete capture object</span></div>
<div class="line">    capture.<a class="code" href="../../d8/dfe/classcv_1_1VideoCapture.html#afb4ab689e553ba2c8f0fec41b9344ae6">release</a>();</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> processImages(<span class="keywordtype">char</span>* fistFrameFilename) {</div>
<div class="line">    <span class="comment">//read the first file of the sequence</span></div>
<div class="line">    frame = <a class="code" href="../../d4/da8/group__imgcodecs.html#ga288b8b3da0892bd651fce07b3bbd3a56">imread</a>(fistFrameFilename);</div>
<div class="line">    <span class="keywordflow">if</span>(frame.<a class="code" href="../../d3/d63/classcv_1_1Mat.html#a17d0777aef52a7cfbdb8d04d189fa5c3">empty</a>()){</div>
<div class="line">        <span class="comment">//error in opening the first image</span></div>
<div class="line">        cerr &lt;&lt; <span class="stringliteral">&quot;Unable to open first image frame: &quot;</span> &lt;&lt; fistFrameFilename &lt;&lt; endl;</div>
<div class="line">        exit(EXIT_FAILURE);</div>
<div class="line">    }</div>
<div class="line">    <span class="comment">//current image filename</span></div>
<div class="line">    <span class="keywordtype">string</span> fn(fistFrameFilename);</div>
<div class="line">    <span class="comment">//read input data. ESC or &#39;q&#39; for quitting</span></div>
<div class="line">    <span class="keywordflow">while</span>( (<span class="keywordtype">char</span>)keyboard != <span class="charliteral">&#39;q&#39;</span> &amp;&amp; (<span class="keywordtype">char</span>)keyboard != 27 ){</div>
<div class="line">        <span class="comment">//update the background model</span></div>
<div class="line">        pMOG2-&gt;apply(frame, fgMaskMOG2);</div>
<div class="line">        <span class="comment">//get the frame number and write it on the current frame</span></div>
<div class="line">        <span class="keywordtype">size_t</span> index = fn.find_last_of(<span class="stringliteral">&quot;/&quot;</span>);</div>
<div class="line">        <span class="keywordflow">if</span>(index == string::npos) {</div>
<div class="line">            index = fn.find_last_of(<span class="stringliteral">&quot;\\&quot;</span>);</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordtype">size_t</span> index2 = fn.find_last_of(<span class="stringliteral">&quot;.&quot;</span>);</div>
<div class="line">        <span class="keywordtype">string</span> prefix = fn.substr(0,index+1);</div>
<div class="line">        <span class="keywordtype">string</span> suffix = fn.substr(index2);</div>
<div class="line">        <span class="keywordtype">string</span> frameNumberString = fn.substr(index+1, index2-index-1);</div>
<div class="line">        istringstream iss(frameNumberString);</div>
<div class="line">        <span class="keywordtype">int</span> frameNumber = 0;</div>
<div class="line">        iss &gt;&gt; frameNumber;</div>
<div class="line">        <a class="code" href="../../d6/d6e/group__imgproc__draw.html#ga07d2f74cadcf8e305e810ce8eed13bc9">rectangle</a>(frame, <a class="code" href="../../db/d4e/classcv_1_1Point__.html">cv::Point</a>(10, 2), <a class="code" href="../../db/d4e/classcv_1_1Point__.html">cv::Point</a>(100,20),</div>
<div class="line">                  <a class="code" href="../../d1/da0/classcv_1_1Scalar__.html">cv::Scalar</a>(255,255,255), -1);</div>
<div class="line">        <a class="code" href="../../d6/d6e/group__imgproc__draw.html#ga5126f47f883d730f633d74f07456c576">putText</a>(frame, frameNumberString.c_str(), <a class="code" href="../../dc/d84/group__core__basic.html#ga1e83eafb2d26b3c93f09e8338bcab192">cv::Point</a>(15, 15),</div>
<div class="line">                <a class="code" href="../../d0/de1/group__core.html#gga0f9314ea6e35f99bb23f29567fc16e11afff8b973668df2e4028dddc5274310c9">FONT_HERSHEY_SIMPLEX</a>, 0.5 , <a class="code" href="../../dc/d84/group__core__basic.html#ga599fe92e910c027be274233eccad7beb">cv::Scalar</a>(0,0,0));</div>
<div class="line">        <span class="comment">//show the current frame and the fg masks</span></div>
<div class="line">        <a class="code" href="../../d7/dfc/group__highgui.html#ga453d42fe4cb60e5723281a89973ee563">imshow</a>(<span class="stringliteral">&quot;Frame&quot;</span>, frame);</div>
<div class="line">        <a class="code" href="../../d7/dfc/group__highgui.html#ga453d42fe4cb60e5723281a89973ee563">imshow</a>(<span class="stringliteral">&quot;FG Mask MOG 2&quot;</span>, fgMaskMOG2);</div>
<div class="line">        <span class="comment">//get the input from the keyboard</span></div>
<div class="line">        keyboard = <a class="code" href="../../d7/dfc/group__highgui.html#ga5628525ad33f52eab17feebcfba38bd7">waitKey</a>( 30 );</div>
<div class="line">        <span class="comment">//search for the next image in the sequence</span></div>
<div class="line">        ostringstream oss;</div>
<div class="line">        oss &lt;&lt; (frameNumber + 1);</div>
<div class="line">        <span class="keywordtype">string</span> nextFrameNumberString = oss.str();</div>
<div class="line">        <span class="keywordtype">string</span> nextFrameFilename = prefix + nextFrameNumberString + suffix;</div>
<div class="line">        <span class="comment">//read the next frame</span></div>
<div class="line">        frame = <a class="code" href="../../d4/da8/group__imgcodecs.html#ga288b8b3da0892bd651fce07b3bbd3a56">imread</a>(nextFrameFilename);</div>
<div class="line">        <span class="keywordflow">if</span>(frame.<a class="code" href="../../d3/d63/classcv_1_1Mat.html#a17d0777aef52a7cfbdb8d04d189fa5c3">empty</a>()){</div>
<div class="line">            <span class="comment">//error in opening the next image in the sequence</span></div>
<div class="line">            cerr &lt;&lt; <span class="stringliteral">&quot;Unable to open image frame: &quot;</span> &lt;&lt; nextFrameFilename &lt;&lt; endl;</div>
<div class="line">            exit(EXIT_FAILURE);</div>
<div class="line">        }</div>
<div class="line">        <span class="comment">//update the path of the current frame</span></div>
<div class="line">        fn.assign(nextFrameFilename);</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><h2>Explanation </h2>
<p>We discuss the main parts of the above code:</p>
<ol type="1">
<li>First, three Mat objects are allocated to store the current frame and two foreground masks, obtained by using two different BS algorithms. <div class="fragment"><div class="line">Mat frame; <span class="comment">//current frame</span></div>
<div class="line">Mat fgMaskMOG; <span class="comment">//fg mask generated by MOG method</span></div>
<div class="line">Mat fgMaskMOG2; <span class="comment">//fg mask fg mask generated by MOG2 method</span></div>
</div><!-- fragment --></li>
<li>Two <a class="el" href="../../d7/df6/classcv_1_1BackgroundSubtractor.html">cv::BackgroundSubtractor</a> objects will be used to generate the foreground masks. In this example, default parameters are used, but it is also possible to declare specific parameters in the create function. <div class="fragment"><div class="line">Ptr&lt;BackgroundSubtractor&gt; pMOG; <span class="comment">//MOG Background subtractor</span></div>
<div class="line">Ptr&lt;BackgroundSubtractor&gt; pMOG2; <span class="comment">//MOG2 Background subtractor</span></div>
<div class="line">...</div>
<div class="line"><span class="comment">//create Background Subtractor objects</span></div>
<div class="line">pMOG = <a class="code" href="../../d6/d17/group__cudabgsegm.html#ga6742648a654585013544eaa300f77b57">createBackgroundSubtractorMOG</a>(); <span class="comment">//MOG approach</span></div>
<div class="line">pMOG2 = <a class="code" href="../../de/de1/group__video__motion.html#ga2beb2dee7a073809ccec60f145b6b29c">createBackgroundSubtractorMOG2</a>(); <span class="comment">//MOG2 approach</span></div>
</div><!-- fragment --></li>
<li>The command line arguments are analysed. The user can chose between two options:<ul>
<li>video files (by choosing the option -vid);</li>
<li>image sequences (by choosing the option -img). <div class="fragment"><div class="line"><span class="keywordflow">if</span>(strcmp(argv[1], <span class="stringliteral">&quot;-vid&quot;</span>) == 0) {</div>
<div class="line">  <span class="comment">//input data coming from a video</span></div>
<div class="line">  processVideo(argv[2]);</div>
<div class="line">}</div>
<div class="line"><span class="keywordflow">else</span> <span class="keywordflow">if</span>(strcmp(argv[1], <span class="stringliteral">&quot;-img&quot;</span>) == 0) {</div>
<div class="line">  <span class="comment">//input data coming from a sequence of images</span></div>
<div class="line">  processImages(argv[2]);</div>
<div class="line">}</div>
</div><!-- fragment --></li>
</ul>
</li>
<li>Suppose you want to process a video file. The video is read until the end is reached or the user presses the button 'q' or the button 'ESC'. <div class="fragment"><div class="line"><span class="keywordflow">while</span>( (<span class="keywordtype">char</span>)keyboard != <span class="charliteral">&#39;q&#39;</span> &amp;&amp; (<span class="keywordtype">char</span>)keyboard != 27 ){</div>
<div class="line">  <span class="comment">//read the current frame</span></div>
<div class="line">  <span class="keywordflow">if</span>(!capture.<a class="code" href="../../d8/dfe/classcv_1_1VideoCapture.html#a473055e77dd7faa4d26d686226b292c1">read</a>(frame)) {</div>
<div class="line">    cerr &lt;&lt; <span class="stringliteral">&quot;Unable to read next frame.&quot;</span> &lt;&lt; endl;</div>
<div class="line">    cerr &lt;&lt; <span class="stringliteral">&quot;Exiting...&quot;</span> &lt;&lt; endl;</div>
<div class="line">    exit(EXIT_FAILURE);</div>
<div class="line">  }</div>
</div><!-- fragment --></li>
<li>Every frame is used both for calculating the foreground mask and for updating the background. If you want to change the learning rate used for updating the background model, it is possible to set a specific learning rate by passing a third parameter to the 'apply' method. <div class="fragment"><div class="line"><span class="comment">//update the background model</span></div>
<div class="line">pMOG-&gt;apply(frame, fgMaskMOG);</div>
<div class="line">pMOG2-&gt;apply(frame, fgMaskMOG2);</div>
</div><!-- fragment --></li>
<li>The current frame number can be extracted from the <a class="el" href="../../d8/dfe/classcv_1_1VideoCapture.html">cv::VideoCapture</a> object and stamped in the top left corner of the current frame. A white rectangle is used to highlight the black colored frame number. <div class="fragment"><div class="line"><span class="comment">//get the frame number and write it on the current frame</span></div>
<div class="line">stringstream ss;</div>
<div class="line"><a class="code" href="../../d6/d6e/group__imgproc__draw.html#ga07d2f74cadcf8e305e810ce8eed13bc9">rectangle</a>(frame, <a class="code" href="../../db/d4e/classcv_1_1Point__.html">cv::Point</a>(10, 2), <a class="code" href="../../db/d4e/classcv_1_1Point__.html">cv::Point</a>(100,20),</div>
<div class="line">          <a class="code" href="../../d1/da0/classcv_1_1Scalar__.html">cv::Scalar</a>(255,255,255), -1);</div>
<div class="line">ss &lt;&lt; capture.<a class="code" href="../../d8/dfe/classcv_1_1VideoCapture.html#aeb1644641842e6b104f244f049648f94">get</a>(<a class="code" href="../../dd/de7/group__videoio.html#gga04495204613753c836e07d31c575bf3ba6223452891755166a4fd5173ea257068">CAP_PROP_POS_FRAMES</a>);</div>
<div class="line"><span class="keywordtype">string</span> frameNumberString = ss.str();</div>
<div class="line"><a class="code" href="../../d6/d6e/group__imgproc__draw.html#ga5126f47f883d730f633d74f07456c576">putText</a>(frame, frameNumberString.c_str(), <a class="code" href="../../dc/d84/group__core__basic.html#ga1e83eafb2d26b3c93f09e8338bcab192">cv::Point</a>(15, 15),</div>
<div class="line">        <a class="code" href="../../d0/de1/group__core.html#gga0f9314ea6e35f99bb23f29567fc16e11afff8b973668df2e4028dddc5274310c9">FONT_HERSHEY_SIMPLEX</a>, 0.5 , <a class="code" href="../../dc/d84/group__core__basic.html#ga599fe92e910c027be274233eccad7beb">cv::Scalar</a>(0,0,0));</div>
</div><!-- fragment --></li>
<li>We are ready to show the current input frame and the results. <div class="fragment"><div class="line"><span class="comment">//show the current frame and the fg masks</span></div>
<div class="line"><a class="code" href="../../d7/dfc/group__highgui.html#ga453d42fe4cb60e5723281a89973ee563">imshow</a>(<span class="stringliteral">&quot;Frame&quot;</span>, frame);</div>
<div class="line"><a class="code" href="../../d7/dfc/group__highgui.html#ga453d42fe4cb60e5723281a89973ee563">imshow</a>(<span class="stringliteral">&quot;FG Mask MOG&quot;</span>, fgMaskMOG);</div>
<div class="line"><a class="code" href="../../d7/dfc/group__highgui.html#ga453d42fe4cb60e5723281a89973ee563">imshow</a>(<span class="stringliteral">&quot;FG Mask MOG 2&quot;</span>, fgMaskMOG2);</div>
</div><!-- fragment --></li>
<li>The same operations listed above can be performed using a sequence of images as input. The processImage function is called and, instead of using a <a class="el" href="../../d8/dfe/classcv_1_1VideoCapture.html">cv::VideoCapture</a> object, the images are read by using <a class="el" href="../../d4/da8/group__imgcodecs.html#ga288b8b3da0892bd651fce07b3bbd3a56">cv::imread</a> , after individuating the correct path for the next frame to read. <div class="fragment"><div class="line"><span class="comment">//read the first file of the sequence</span></div>
<div class="line">frame = <a class="code" href="../../d4/da8/group__imgcodecs.html#ga288b8b3da0892bd651fce07b3bbd3a56">imread</a>(fistFrameFilename);</div>
<div class="line"><span class="keywordflow">if</span>(!frame.data){</div>
<div class="line">  <span class="comment">//error in opening the first image</span></div>
<div class="line">  cerr &lt;&lt; <span class="stringliteral">&quot;Unable to open first image frame: &quot;</span> &lt;&lt; fistFrameFilename &lt;&lt; endl;</div>
<div class="line">  exit(EXIT_FAILURE);</div>
<div class="line">}</div>
<div class="line">...</div>
<div class="line"><span class="comment">//search for the next image in the sequence</span></div>
<div class="line">ostringstream oss;</div>
<div class="line">oss &lt;&lt; (frameNumber + 1);</div>
<div class="line"><span class="keywordtype">string</span> nextFrameNumberString = oss.str();</div>
<div class="line"><span class="keywordtype">string</span> nextFrameFilename = prefix + nextFrameNumberString + suffix;</div>
<div class="line"><span class="comment">//read the next frame</span></div>
<div class="line">frame = <a class="code" href="../../d4/da8/group__imgcodecs.html#ga288b8b3da0892bd651fce07b3bbd3a56">imread</a>(nextFrameFilename);</div>
<div class="line"><span class="keywordflow">if</span>(!frame.data){</div>
<div class="line">  <span class="comment">//error in opening the next image in the sequence</span></div>
<div class="line">  cerr &lt;&lt; <span class="stringliteral">&quot;Unable to open image frame: &quot;</span> &lt;&lt; nextFrameFilename &lt;&lt; endl;</div>
<div class="line">  exit(EXIT_FAILURE);</div>
<div class="line">}</div>
<div class="line"><span class="comment">//update the path of the current frame</span></div>
<div class="line">fn.assign(nextFrameFilename);</div>
</div><!-- fragment --> Note that this example works only on image sequences in which the filename format is &lt;n&gt;.png, where n is the frame number (e.g., 7.png).</li>
</ol>
<h2>Results </h2>
<ul>
<li><p class="startli">Given the following input parameters: </p>
<div class="fragment"><div class="line">-vid Video_001.avi</div>
</div><!-- fragment --><p> The output of the program will look as the following:</p>
<div class="image">
<img src="../../Background_Subtraction_Tutorial_Result_1.png" alt="Background_Subtraction_Tutorial_Result_1.png"/>
</div>
</li>
<li>The video file Video_001.avi is part of the <a href="http://bmc.univ-bpclermont.fr/">Background Models Challenge (BMC)</a> data set and it can be downloaded from the following link <a href="http://bmc.univ-bpclermont.fr/sites/default/files/videos/evaluation/Video_001.zip">Video_001</a> (about 32 MB).</li>
<li><p class="startli">If you want to process a sequence of images, then the '-img' option has to be chosen: </p>
<div class="fragment"><div class="line">-img 111_png/input/1.png</div>
</div><!-- fragment --><p> The output of the program will look as the following:</p>
<div class="image">
<img src="../../Background_Subtraction_Tutorial_Result_2.png" alt="Background_Subtraction_Tutorial_Result_2.png"/>
</div>
</li>
<li>The sequence of images used in this example is part of the <a href="http://bmc.univ-bpclermont.fr/">Background Models Challenge (BMC)</a> dataset and it can be downloaded from the following link <a href="http://bmc.univ-bpclermont.fr/sites/default/files/videos/learning/111_png.zip">sequence 111</a> (about 708 MB). Please, note that this example works only on sequences in which the filename format is &lt;n&gt;.png, where n is the frame number (e.g., 7.png).</li>
</ul>
<h2>Evaluation </h2>
<p>To quantitatively evaluate the results obtained, we need to:</p>
<ul>
<li>Save the output images;</li>
<li>Have the ground truth images for the chosen sequence.</li>
</ul>
<p>In order to save the output images, we can use <a class="el" href="../../d4/da8/group__imgcodecs.html#gabbc7ef1aa2edfaa87772f1202d67e0ce">cv::imwrite</a> . Adding the following code allows for saving the foreground masks. </p>
<div class="fragment"><div class="line"><span class="keywordtype">string</span> imageToSave = <span class="stringliteral">&quot;output_MOG_&quot;</span> + frameNumberString + <span class="stringliteral">&quot;.png&quot;</span>;</div>
<div class="line"><span class="keywordtype">bool</span> saved = <a class="code" href="../../d4/da8/group__imgcodecs.html#gabbc7ef1aa2edfaa87772f1202d67e0ce">imwrite</a>(imageToSave, fgMaskMOG);</div>
<div class="line"><span class="keywordflow">if</span>(!saved) {</div>
<div class="line">  cerr &lt;&lt; <span class="stringliteral">&quot;Unable to save &quot;</span> &lt;&lt; imageToSave &lt;&lt; endl;</div>
<div class="line">}</div>
</div><!-- fragment --><p> Once we have collected the result images, we can compare them with the ground truth data. There exist several publicly available sequences for background subtraction that come with ground truth data. If you decide to use the <a href="http://bmc.univ-bpclermont.fr/">Background Models Challenge (BMC)</a>, then the result images can be used as input for the <a href="http://bmc.univ-bpclermont.fr/?q=node/7">BMC Wizard</a>. The wizard can compute different measures about the accuracy of the results.</p>
<h2>References </h2>
<ul>
<li><a href="http://bmc.univ-bpclermont.fr/">Background Models Challenge (BMC) website</a></li>
<li>A Benchmark Dataset for Foreground/Background Extraction <a class="el" href="../../d0/de3/citelist.html#CITEREF_vacavant2013benchmark">vacavant2013benchmark</a> </li>
</ul>
</div></div><!-- contents -->
<!-- HTML footer for doxygen 1.8.6-->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Sat Jun 20 2015 13:08:41 for OpenCV by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/>
</a> 1.8.6
</small></address>
</body>
</html>
