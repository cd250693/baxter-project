<!-- HTML header for doxygen 1.8.6-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>OpenCV: Intel速 IPP Asynchronous C/C++ library in OpenCV</title>
<link href="../../opencv.ico" rel="shortcut icon" type="image/x-icon" />
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js", "TeX/AMSmath.js", "TeX/AMSsymbols.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
MathJax.Hub.Config(
{
  TeX: {
      Macros: {
          matTT: [ "\\[ \\left|\\begin{array}{ccc} #1 & #2 & #3\\\\ #4 & #5 & #6\\\\ #7 & #8 & #9 \\end{array}\\right| \\]", 9],
          fork: ["\\left\\{ \\begin{array}{l l} #1 & \\mbox{#2}\\\\ #3 & \\mbox{#4}\\\\ \\end{array} \\right.", 4],
          forkthree: ["\\left\\{ \\begin{array}{l l} #1 & \\mbox{#2}\\\\ #3 & \\mbox{#4}\\\\ #5 & \\mbox{#6}\\\\ \\end{array} \\right.", 6],
          vecthree: ["\\begin{bmatrix} #1\\\\ #2\\\\ #3 \\end{bmatrix}", 3],
          vecthreethree: ["\\begin{bmatrix} #1 & #2 & #3\\\\ #4 & #5 & #6\\\\ #7 & #8 & #9 \\end{bmatrix}", 9],
          hdotsfor: ["\\dots", 1],
          mathbbm: ["\\mathbb{#1}", 1],
          bordermatrix: ["\\matrix{#1}", 1]
      }
  }
}
);
</script><script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="../../stylesheet.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="../../opencv-logo-small.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">OpenCV
   &#160;<span id="projectnumber">3.0.0</span>
   </div>
   <div id="projectbrief">Open Source Computer Vision</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="../../pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="../../modules.html"><span>Modules</span></a></li>
      <li><a href="../../namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="../../annotated.html"><span>Classes</span></a></li>
      <li><a href="../../files.html"><span>Files</span></a></li>
      <li><a href="../../examples.html"><span>Examples</span></a></li>
      <li><a href="../..//3.0-last-rst"><span>Sphinx&#160;Documentation</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="../../search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="../../search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Properties</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(11)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(12)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(13)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="../../d9/df8/tutorial_root.html">OpenCV Tutorials</a></li><li class="navelem"><a class="el" href="../../de/d7a/tutorial_table_of_content_core.html">The Core Functionality (core module)</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Intel速 IPP Asynchronous C/C++ library in OpenCV </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h2>Goal </h2>
<p>The tutorial demonstrates the <a href="http://software.intel.com/en-us/intel-ipp-preview">Intel速 IPP Asynchronous C/C++</a> library usage with OpenCV. The code example below illustrates implementation of the Sobel operation, accelerated with Intel速 IPP Asynchronous C/C++ functions. In this code example, <a class="el" href="../../d6/dcf/group__core__ipp.html#ga6b6a7a9c44efd50c8aaf9fb0866a363a">cv::hpp::getMat</a> and <a class="el" href="../../d6/dcf/group__core__ipp.html#gae751e7f96d79f90699fdf71bdaa87a6b">cv::hpp::getHpp</a> functions are used for data conversion between <a href="http://software.intel.com/en-us/node/501660">hppiMatrix</a> and Mat matrices.</p>
<h2>Code </h2>
<p>You may also find the source code in the <code>samples/cpp/tutorial_code/core/ippasync/ippasync_sample.cpp</code> file of the OpenCV source library or download it from <a href="https://github.com/Itseez/opencv/tree/master/samples/cpp/tutorial_code/core/ippasync/ippasync_sample.cpp">here</a>.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;stdio.h&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="../../d1/d4e/utility_8hpp.html">opencv2/core/utility.hpp</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="../../dd/d46/imgproc_8hpp.html">opencv2/imgproc.hpp</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="../../d4/dd5/highgui_8hpp.html">opencv2/highgui.hpp</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;cvconfig.h&quot;</span></div>
<div class="line"></div>
<div class="line"><span class="keyword">using namespace </span>std;</div>
<div class="line"><span class="keyword">using namespace </span>cv;</div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#ifdef HAVE_IPP_A</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#include &quot;<a class="code" href="../../d1/d8c/ippasync_8hpp.html">opencv2/core/ippasync.hpp</a>&quot;</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#define CHECK_STATUS(STATUS, NAME)\</span></div>
<div class="line"><span class="preprocessor">    if(STATUS!=HPP_STATUS_NO_ERROR){ printf(&quot;%s error %d\n&quot;, NAME, STATUS);\</span></div>
<div class="line"><span class="preprocessor">    if (virtMatrix) {hppStatus delSts = hppiDeleteVirtualMatrices(accel, virtMatrix); CHECK_DEL_STATUS(delSts,&quot;hppiDeleteVirtualMatrices&quot;);}\</span></div>
<div class="line"><span class="preprocessor">    if (accel)      {hppStatus delSts = hppDeleteInstance(accel); CHECK_DEL_STATUS(delSts, &quot;hppDeleteInstance&quot;);}\</span></div>
<div class="line"><span class="preprocessor">    return -1;}</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line"><span class="preprocessor">#define CHECK_DEL_STATUS(STATUS, NAME)\</span></div>
<div class="line"><span class="preprocessor">    if(STATUS!=HPP_STATUS_NO_ERROR){ printf(&quot;%s error %d\n&quot;, NAME, STATUS); return -1;}</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> help()</div>
<div class="line">{</div>
<div class="line"> printf(<span class="stringliteral">&quot;\nThis program shows how to use the conversion for IPP Async.\n&quot;</span></div>
<div class="line"><span class="stringliteral">&quot;This example uses the Sobel filter.\n&quot;</span></div>
<div class="line"><span class="stringliteral">&quot;You can use cv::Sobel or hppiSobel.\n&quot;</span></div>
<div class="line"><span class="stringliteral">&quot;Usage: \n&quot;</span></div>
<div class="line"><span class="stringliteral">&quot;./ipp_async_sobel [--camera]=&lt;use camera,if this key is present&gt;, \n&quot;</span></div>
<div class="line"><span class="stringliteral">&quot;                  [--file_name]=&lt;path to movie or image file&gt;\n&quot;</span></div>
<div class="line"><span class="stringliteral">&quot;                  [--accel]=&lt;accelerator type: auto (default), cpu, gpu&gt;\n\n&quot;</span>);</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">char</span>* keys =</div>
<div class="line">{</div>
<div class="line">    <span class="stringliteral">&quot;{c  camera   |           | use camera or not}&quot;</span></div>
<div class="line">    <span class="stringliteral">&quot;{fn file_name|../data/baboon.jpg | image file       }&quot;</span></div>
<div class="line">    <span class="stringliteral">&quot;{a accel     |auto       | accelerator type: auto (default), cpu, gpu}&quot;</span></div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><span class="comment">//this is a sample for hppiSobel functions</span></div>
<div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keyword">const</span> <span class="keywordtype">char</span>** argv)</div>
<div class="line">{</div>
<div class="line">    help();</div>
<div class="line"></div>
<div class="line">    <a class="code" href="../../d8/dfe/classcv_1_1VideoCapture.html">VideoCapture</a> cap;</div>
<div class="line">    <a class="code" href="../../d0/d2e/classcv_1_1CommandLineParser.html">CommandLineParser</a> parser(argc, argv, keys);</div>
<div class="line">    <a class="code" href="../../d3/d63/classcv_1_1Mat.html">Mat</a> image, gray, result;</div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#ifdef HAVE_IPP_A</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line">    hppiMatrix* src,* dst;</div>
<div class="line">    hppAccel accel = 0;</div>
<div class="line">    hppAccelType accelType;</div>
<div class="line">    hppStatus sts;</div>
<div class="line">    hppiVirtualMatrix * virtMatrix;</div>
<div class="line"></div>
<div class="line">    <span class="keywordtype">bool</span> useCamera = parser.has(<span class="stringliteral">&quot;camera&quot;</span>);</div>
<div class="line">    <span class="keywordtype">string</span> file = parser.get&lt;<span class="keywordtype">string</span>&gt;(<span class="stringliteral">&quot;file_name&quot;</span>);</div>
<div class="line">    <span class="keywordtype">string</span> sAccel = parser.get&lt;<span class="keywordtype">string</span>&gt;(<span class="stringliteral">&quot;accel&quot;</span>);</div>
<div class="line"></div>
<div class="line">    parser.printMessage();</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span>( useCamera )</div>
<div class="line">    {</div>
<div class="line">        printf(<span class="stringliteral">&quot;used camera\n&quot;</span>);</div>
<div class="line">        cap.<a class="code" href="../../d8/dfe/classcv_1_1VideoCapture.html#ab5b7391cd5ec50e7237e575a758f6f05">open</a>(0);</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span></div>
<div class="line">    {</div>
<div class="line">        printf(<span class="stringliteral">&quot;used image %s\n&quot;</span>, file.c_str());</div>
<div class="line">        cap.<a class="code" href="../../d8/dfe/classcv_1_1VideoCapture.html#ab5b7391cd5ec50e7237e575a758f6f05">open</a>(file.c_str());</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span>( !cap.<a class="code" href="../../d8/dfe/classcv_1_1VideoCapture.html#ad62969b4aaa492f9ed021263d1a42f1b">isOpened</a>() )</div>
<div class="line">    {</div>
<div class="line">        printf(<span class="stringliteral">&quot;can not open camera or video file\n&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    accelType = sAccel == <span class="stringliteral">&quot;cpu&quot;</span> ? HPP_ACCEL_TYPE_CPU:</div>
<div class="line">                sAccel == <span class="stringliteral">&quot;gpu&quot;</span> ? HPP_ACCEL_TYPE_GPU:</div>
<div class="line">                                  HPP_ACCEL_TYPE_ANY;</div>
<div class="line"></div>
<div class="line">    <span class="comment">//Create accelerator instance</span></div>
<div class="line">    sts = hppCreateInstance(accelType, 0, &amp;accel);</div>
<div class="line">    CHECK_STATUS(sts, <span class="stringliteral">&quot;hppCreateInstance&quot;</span>);</div>
<div class="line"></div>
<div class="line">    accelType = hppQueryAccelType(accel);</div>
<div class="line"></div>
<div class="line">    sAccel = accelType == HPP_ACCEL_TYPE_CPU ? <span class="stringliteral">&quot;cpu&quot;</span>:</div>
<div class="line">             accelType == HPP_ACCEL_TYPE_GPU ? <span class="stringliteral">&quot;gpu&quot;</span>:</div>
<div class="line">             accelType == HPP_ACCEL_TYPE_GPU_VIA_DX9 ? <span class="stringliteral">&quot;gpu dx9&quot;</span>: <span class="stringliteral">&quot;?&quot;</span>;</div>
<div class="line"></div>
<div class="line">    printf(<span class="stringliteral">&quot;accelType %s\n&quot;</span>, sAccel.c_str());</div>
<div class="line"></div>
<div class="line">    virtMatrix = hppiCreateVirtualMatrices(accel, 1);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">for</span>(;;)</div>
<div class="line">    {</div>
<div class="line">        cap &gt;&gt; image;</div>
<div class="line">        <span class="keywordflow">if</span>(image.empty())</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line"></div>
<div class="line">        <a class="code" href="../../d7/d1b/group__imgproc__misc.html#ga397ae87e1288a81d2363b61574eb8cab">cvtColor</a>( image, gray, <a class="code" href="../../d7/d1b/group__imgproc__misc.html#gga4e0972be5de079fed4e3a10e24ef5ef0a353a4b8db9040165db4dacb5bcefb6ea">COLOR_BGR2GRAY</a> );</div>
<div class="line"></div>
<div class="line">        result.<a class="code" href="../../d3/d63/classcv_1_1Mat.html#a55ced2c8d844d683ea9a725c60037ad0">create</a>( image.rows, image.cols, <a class="code" href="../../dc/dcc/cvdef_8h.html#a32b18d904ee2b1731a9416a8eef67d06">CV_8U</a>);</div>
<div class="line"></div>
<div class="line">        <span class="keywordtype">double</span> execTime = (double)<a class="code" href="../../db/de0/group__core__utils.html#gae73f58000611a1af25dd36d496bf4487">getTickCount</a>();</div>
<div class="line"></div>
<div class="line">        <span class="comment">//convert Mat to hppiMatrix</span></div>
<div class="line">        src = <a class="code" href="../../d6/dcf/group__core__ipp.html#gae751e7f96d79f90699fdf71bdaa87a6b">hpp::getHpp</a>(gray,accel);</div>
<div class="line">        dst = <a class="code" href="../../d6/dcf/group__core__ipp.html#gae751e7f96d79f90699fdf71bdaa87a6b">hpp::getHpp</a>(result,accel);</div>
<div class="line"></div>
<div class="line">        sts = hppiSobel(accel,src, HPP_MASK_SIZE_3X3,HPP_NORM_L1,virtMatrix[0]);</div>
<div class="line">        CHECK_STATUS(sts,<span class="stringliteral">&quot;hppiSobel&quot;</span>);</div>
<div class="line"></div>
<div class="line">        sts = hppiConvert(accel, virtMatrix[0], 0, HPP_RND_MODE_NEAR, dst, HPP_DATA_TYPE_8U);</div>
<div class="line">        CHECK_STATUS(sts,<span class="stringliteral">&quot;hppiConvert&quot;</span>);</div>
<div class="line"></div>
<div class="line">        <span class="comment">// Wait for tasks to complete</span></div>
<div class="line">        sts = hppWait(accel, HPP_TIME_OUT_INFINITE);</div>
<div class="line">        CHECK_STATUS(sts, <span class="stringliteral">&quot;hppWait&quot;</span>);</div>
<div class="line"></div>
<div class="line">        execTime = ((double)<a class="code" href="../../db/de0/group__core__utils.html#gae73f58000611a1af25dd36d496bf4487">getTickCount</a>() - execTime)*1000./<a class="code" href="../../db/de0/group__core__utils.html#ga705441a9ef01f47acdc55d87fbe5090c">getTickFrequency</a>();</div>
<div class="line"></div>
<div class="line">        printf(<span class="stringliteral">&quot;Time : %0.3fms\n&quot;</span>, execTime);</div>
<div class="line"></div>
<div class="line">        <a class="code" href="../../d7/dfc/group__highgui.html#ga453d42fe4cb60e5723281a89973ee563">imshow</a>(<span class="stringliteral">&quot;image&quot;</span>, image);</div>
<div class="line">        <a class="code" href="../../d7/dfc/group__highgui.html#ga453d42fe4cb60e5723281a89973ee563">imshow</a>(<span class="stringliteral">&quot;rez&quot;</span>, result);</div>
<div class="line"></div>
<div class="line">        <a class="code" href="../../d7/dfc/group__highgui.html#ga5628525ad33f52eab17feebcfba38bd7">waitKey</a>(15);</div>
<div class="line"></div>
<div class="line">        sts =  hppiFreeMatrix(src);</div>
<div class="line">        CHECK_DEL_STATUS(sts,<span class="stringliteral">&quot;hppiFreeMatrix&quot;</span>);</div>
<div class="line"></div>
<div class="line">        sts =  hppiFreeMatrix(dst);</div>
<div class="line">        CHECK_DEL_STATUS(sts,<span class="stringliteral">&quot;hppiFreeMatrix&quot;</span>);</div>
<div class="line"></div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (!useCamera)</div>
<div class="line">        <a class="code" href="../../d7/dfc/group__highgui.html#ga5628525ad33f52eab17feebcfba38bd7">waitKey</a>(0);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (virtMatrix)</div>
<div class="line">    {</div>
<div class="line">        sts = hppiDeleteVirtualMatrices(accel, virtMatrix);</div>
<div class="line">        CHECK_DEL_STATUS(sts,<span class="stringliteral">&quot;hppiDeleteVirtualMatrices&quot;</span>);</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (accel)</div>
<div class="line">    {</div>
<div class="line">        sts = hppDeleteInstance(accel);</div>
<div class="line">        CHECK_DEL_STATUS(sts, <span class="stringliteral">&quot;hppDeleteInstance&quot;</span>);</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    printf(<span class="stringliteral">&quot;SUCCESS\n&quot;</span>);</div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#else</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line">    printf(<span class="stringliteral">&quot;IPP Async not supported\n&quot;</span>);</div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
</div><!-- fragment --><h2>Explanation </h2>
<ol type="1">
<li>Create parameters for OpenCV: <div class="fragment"><div class="line">VideoCapture cap;</div>
<div class="line">Mat image, gray, result;</div>
</div><!-- fragment --> and IPP Async: <div class="fragment"><div class="line">hppiMatrix* src,* dst;</div>
<div class="line">hppAccel accel = 0;</div>
<div class="line">hppAccelType accelType;</div>
<div class="line">hppStatus sts;</div>
<div class="line">hppiVirtualMatrix * virtMatrix;</div>
</div><!-- fragment --></li>
<li>Load input image or video. How to open and read video stream you can see in the <a class="el" href="../../d5/dc4/tutorial_video_input_psnr_ssim.html">Video Input with OpenCV and similarity measurement</a> tutorial. <div class="fragment"><div class="line"><span class="keywordflow">if</span>( useCamera )</div>
<div class="line">{</div>
<div class="line">   printf(<span class="stringliteral">&quot;used camera\n&quot;</span>);</div>
<div class="line">   cap.open(0);</div>
<div class="line">}</div>
<div class="line"><span class="keywordflow">else</span></div>
<div class="line">{</div>
<div class="line">   printf(<span class="stringliteral">&quot;used image %s\n&quot;</span>, file.c_str());</div>
<div class="line">   cap.open(file.c_str());</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordflow">if</span>( !cap.isOpened() )</div>
<div class="line">{</div>
<div class="line">   printf(<span class="stringliteral">&quot;can not open camera or video file\n&quot;</span>);</div>
<div class="line">   <span class="keywordflow">return</span> -1;</div>
<div class="line">}</div>
</div><!-- fragment --></li>
<li>Create accelerator instance using <a href="http://software.intel.com/en-us/node/501686">hppCreateInstance</a>: <div class="fragment"><div class="line">accelType = sAccel == <span class="stringliteral">&quot;cpu&quot;</span> ? HPP_ACCEL_TYPE_CPU:</div>
<div class="line">            sAccel == <span class="stringliteral">&quot;gpu&quot;</span> ? HPP_ACCEL_TYPE_GPU:</div>
<div class="line">                              HPP_ACCEL_TYPE_ANY;</div>
<div class="line"></div>
<div class="line"><span class="comment">//Create accelerator instance</span></div>
<div class="line">sts = hppCreateInstance(accelType, 0, &amp;accel);</div>
<div class="line">CHECK_STATUS(sts, <span class="stringliteral">&quot;hppCreateInstance&quot;</span>);</div>
</div><!-- fragment --></li>
<li>Create an array of virtual matrices using <a href="http://software.intel.com/en-us/node/501700">hppiCreateVirtualMatrices</a> function. <div class="fragment"><div class="line">virtMatrix = hppiCreateVirtualMatrices(accel, 1);</div>
</div><!-- fragment --></li>
<li>Prepare a matrix for input and output data: <div class="fragment"><div class="line">cap &gt;&gt; image;</div>
<div class="line"><span class="keywordflow">if</span>(image.empty())</div>
<div class="line">   <span class="keywordflow">break</span>;</div>
<div class="line"></div>
<div class="line"><a class="code" href="../../d7/d1b/group__imgproc__misc.html#ga397ae87e1288a81d2363b61574eb8cab">cvtColor</a>( image, gray, <a class="code" href="../../d7/d1b/group__imgproc__misc.html#gga4e0972be5de079fed4e3a10e24ef5ef0a353a4b8db9040165db4dacb5bcefb6ea">COLOR_BGR2GRAY</a> );</div>
<div class="line"></div>
<div class="line">result.create( image.rows, image.cols, <a class="code" href="../../dc/dcc/cvdef_8h.html#a32b18d904ee2b1731a9416a8eef67d06">CV_8U</a>);</div>
</div><!-- fragment --></li>
<li>Convert Mat to <a href="http://software.intel.com/en-us/node/501660">hppiMatrix</a> using <a class="el" href="../../d6/dcf/group__core__ipp.html#gae751e7f96d79f90699fdf71bdaa87a6b">cv::hpp::getHpp</a> and call <a href="http://software.intel.com/en-us/node/474701">hppiSobel</a> function. <div class="fragment"><div class="line"><span class="comment">//convert Mat to hppiMatrix</span></div>
<div class="line">src = <a class="code" href="../../d6/dcf/group__core__ipp.html#gae751e7f96d79f90699fdf71bdaa87a6b">getHpp</a>(gray, accel);</div>
<div class="line">dst = <a class="code" href="../../d6/dcf/group__core__ipp.html#gae751e7f96d79f90699fdf71bdaa87a6b">getHpp</a>(result, accel);</div>
<div class="line"></div>
<div class="line">sts = hppiSobel(accel,src, HPP_MASK_SIZE_3X3,HPP_NORM_L1,virtMatrix[0]);</div>
<div class="line">CHECK_STATUS(sts,<span class="stringliteral">&quot;hppiSobel&quot;</span>);</div>
<div class="line"></div>
<div class="line">sts = hppiConvert(accel, virtMatrix[0], 0, HPP_RND_MODE_NEAR, dst, HPP_DATA_TYPE_8U);</div>
<div class="line">CHECK_STATUS(sts,<span class="stringliteral">&quot;hppiConvert&quot;</span>);</div>
<div class="line"></div>
<div class="line"><span class="comment">// Wait for tasks to complete</span></div>
<div class="line">sts = hppWait(accel, HPP_TIME_OUT_INFINITE);</div>
<div class="line">CHECK_STATUS(sts, <span class="stringliteral">&quot;hppWait&quot;</span>);</div>
</div><!-- fragment --> We use <a href="http://software.intel.com/en-us/node/501746">hppiConvert</a> because <a href="http://software.intel.com/en-us/node/474701">hppiSobel</a> returns destination matrix with HPP_DATA_TYPE_16S data type for source matrix with HPP_DATA_TYPE_8U type. You should check hppStatus after each call IPP Async function.</li>
<li>Create windows and show the images, the usual way. <div class="fragment"><div class="line"><a class="code" href="../../d7/dfc/group__highgui.html#ga453d42fe4cb60e5723281a89973ee563">imshow</a>(<span class="stringliteral">&quot;image&quot;</span>, image);</div>
<div class="line"><a class="code" href="../../d7/dfc/group__highgui.html#ga453d42fe4cb60e5723281a89973ee563">imshow</a>(<span class="stringliteral">&quot;rez&quot;</span>, result);</div>
<div class="line"></div>
<div class="line"><a class="code" href="../../d7/dfc/group__highgui.html#ga5628525ad33f52eab17feebcfba38bd7">waitKey</a>(15);</div>
</div><!-- fragment --></li>
<li>Delete hpp matrices. <div class="fragment"><div class="line">sts =  hppiFreeMatrix(src);</div>
<div class="line">CHECK_DEL_STATUS(sts,<span class="stringliteral">&quot;hppiFreeMatrix&quot;</span>);</div>
<div class="line"></div>
<div class="line">sts =  hppiFreeMatrix(dst);</div>
<div class="line">CHECK_DEL_STATUS(sts,<span class="stringliteral">&quot;hppiFreeMatrix&quot;</span>);</div>
</div><!-- fragment --></li>
<li>Delete virtual matrices and accelerator instance. <div class="fragment"><div class="line"><span class="keywordflow">if</span> (virtMatrix)</div>
<div class="line">{</div>
<div class="line">   sts = hppiDeleteVirtualMatrices(accel, virtMatrix);</div>
<div class="line">   CHECK_DEL_STATUS(sts,<span class="stringliteral">&quot;hppiDeleteVirtualMatrices&quot;</span>);</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordflow">if</span> (accel)</div>
<div class="line">{</div>
<div class="line">   sts = hppDeleteInstance(accel);</div>
<div class="line">   CHECK_DEL_STATUS(sts, <span class="stringliteral">&quot;hppDeleteInstance&quot;</span>);</div>
<div class="line">}</div>
</div><!-- fragment --></li>
</ol>
<h2>Result </h2>
<p>After compiling the code above we can execute it giving an image or video path and accelerator type as an argument. For this tutorial we use baboon.png image as input. The result is below.</p>
<div class="image">
<img src="../../How_To_Use_IPPA_Result.jpg" alt="How_To_Use_IPPA_Result.jpg"/>
</div>
 </div></div><!-- contents -->
<!-- HTML footer for doxygen 1.8.6-->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Sat Jun 20 2015 13:08:38 for OpenCV by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/>
</a> 1.8.6
</small></address>
</body>
</html>
